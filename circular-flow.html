<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circular Flow Model Lab | ClassClick</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
            min-height: 100vh; 
            color: #333;
        }
        
        .header { background: #2B2D42; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .header h1 { font-size: 1.5rem; }
        .header span { color: #F59E0B; }
        .progress-bar { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .progress-dot { width: 12px; height: 12px; border-radius: 50%; background: #555; transition: all 0.3s; }
        .progress-dot.complete { background: #F59E0B; }
        .progress-dot.active { background: #14B8A6; box-shadow: 0 0 8px #14B8A6; }
        .progress-label { font-size: 0.75rem; color: #aaa; margin-left: 5px; }
        
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; overflow-x: auto; }
        .tab { padding: 12px 24px; background: #2B2D42; color: #888; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-size: 1rem; transition: all 0.3s; white-space: nowrap; }
        .tab:hover:not(:disabled) { background: #3B3D52; }
        .tab.active { background: white; color: #2B2D42; font-weight: bold; }
        .tab:disabled { cursor: not-allowed; opacity: 0.5; }
        .tab.locked::before { content: "üîí "; }
        
        .panel { display: none; background: white; border-radius: 0 12px 12px 12px; padding: 30px; min-height: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .panel.active { display: block; }
        
        .lesson-title { font-size: 1.8rem; color: #2B2D42; margin-bottom: 15px; }
        .lesson-text { font-size: 1.1rem; line-height: 1.7; color: #444; margin-bottom: 20px; }
        .term { font-weight: bold; color: #F59E0B; }
        
        .diagram-container { background: #F8F8F8; padding: 20px; border-radius: 12px; margin: 25px 0; border: 2px solid #E5E7EB; text-align: center; }
        .diagram-img { max-width: 100%; height: auto; border-radius: 8px; }
        
        .interactive-prompt { background: #FEF3C7; border-left: 4px solid #F59E0B; padding: 15px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        
        .lesson-nav { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; gap: 10px; flex-wrap: wrap; }
        .lesson-progress { color: #888; font-size: 0.9rem; }
        .btn { padding: 12px 28px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.2s; min-height: 44px; }
        .btn-primary { background: #F59E0B; color: white; }
        .btn-primary:hover { background: #D97706; }
        .btn-secondary { background: #eee; color: #666; }
        .btn-secondary:hover { background: #ddd; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .practice-scenario { background: #F8F8F8; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        .scenario-question { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: #2B2D42; }
        .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0; }
        .btn-small { padding: 10px 20px; font-size: 0.9rem; border-radius: 6px; border: 2px solid #ddd; background: white; cursor: pointer; transition: all 0.2s; min-height: 44px; }
        .btn-small:hover { border-color: #F59E0B; background: #FEF3C7; }
        .btn-small.selected { border-color: #F59E0B; background: #F59E0B; color: white; }
        
        .quiz-question { background: #F8F8F8; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-option { padding: 15px 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; min-height: 44px; }
        .quiz-option:hover { border-color: #F59E0B; background: #FEF3C7; }
        .quiz-option.selected { border-color: #F59E0B; background: #FEF3C7; }
        .quiz-option.correct { border-color: #10B981; background: #D1FAE5; }
        .quiz-option.incorrect { border-color: #EF4444; background: #FEE2E2; }
        
        .feedback { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }
        .feedback.correct { background: #D1FAE5; color: #065F46; }
        .feedback.incorrect { background: #FEE2E2; color: #991B1B; }
        
        .score-screen { text-align: center; padding: 40px; }
        .score-big { font-size: 5rem; font-weight: bold; color: #F59E0B; }
        .score-label { font-size: 1.5rem; color: #666; margin-bottom: 30px; }
        
        /* Flashcards - Multiple Choice Challenge */
        .flashcard-header { display: flex; justify-content: space-around; align-items: center; max-width: 700px; margin: 0 auto 20px; flex-wrap: wrap; gap: 15px; background: #F8F8F8; padding: 15px; border-radius: 12px; }
        .flashcard-stat { text-align: center; }
        .flashcard-stat-value { font-size: 1.8rem; font-weight: bold; color: #F59E0B; }
        .flashcard-stat-label { font-size: 0.85rem; color: #666; text-transform: uppercase; }
        .flashcard-progress-bar { width: 100%; max-width: 700px; height: 12px; background: #E5E7EB; border-radius: 6px; margin: 0 auto 30px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .flashcard-progress-fill { height: 100%; background: linear-gradient(90deg, #F59E0B 0%, #14B8A6 100%); transition: width 0.3s; }
        
        .flashcard-challenge { 
            max-width: 700px; 
            margin: 30px auto; 
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        .flashcard-term { 
            font-size: 2rem; 
            font-weight: bold; 
            color: #2B2D42; 
            text-align: center; 
            padding: 30px;
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-radius: 12px;
            margin-bottom: 30px;
            border: 3px solid #F59E0B;
        }
        .flashcard-question { 
            text-align: center; 
            font-size: 1.2rem; 
            color: #666; 
            margin-bottom: 25px;
            font-weight: 500;
        }
        .flashcard-choices { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
        }
        .flashcard-choice { 
            padding: 20px 25px; 
            border: 3px solid #ddd; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-size: 1.1rem;
            background: white;
            text-align: left;
            position: relative;
        }
        .flashcard-choice:hover:not(.correct):not(.incorrect):not(:disabled) { 
            border-color: #F59E0B; 
            background: #FEF3C7; 
            transform: translateX(5px);
        }
        .flashcard-choice.correct { 
            border-color: #10B981; 
            background: #D1FAE5; 
            animation: pulse 0.5s;
        }
        .flashcard-choice.correct::before {
            content: '‚úì';
            position: absolute;
            right: 20px;
            font-size: 2rem;
            color: #10B981;
            font-weight: bold;
        }
        .flashcard-choice.incorrect { 
            border-color: #EF4444; 
            background: #FEE2E2; 
            opacity: 0.5;
            cursor: not-allowed;
        }
        .flashcard-choice.incorrect::before {
            content: '‚úó';
            position: absolute;
            right: 20px;
            font-size: 2rem;
            color: #EF4444;
            font-weight: bold;
        }
        .flashcard-choice:disabled { cursor: not-allowed; }
        
        .flashcard-feedback { 
            margin-top: 20px; 
            padding: 15px 20px; 
            border-radius: 8px; 
            font-weight: 500;
            text-align: center;
            font-size: 1.1rem;
        }
        .flashcard-feedback.correct { 
            background: #D1FAE5; 
            color: #065F46; 
            border: 2px solid #10B981;
        }
        .flashcard-feedback.incorrect { 
            background: #FEE2E2; 
            color: #991B1B; 
            border: 2px solid #EF4444;
        }
        
        .flashcard-streak { 
            text-align: center; 
            margin: 15px 0;
            font-size: 1.5rem;
            font-weight: bold;
            color: #F59E0B;
        }
        .streak-fire { 
            display: inline-block; 
            animation: bounce 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .certificate { background: white; border: 10px solid #2B2D42; padding: 40px; text-align: center; max-width: 800px; margin: 20px auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .certificate-border { border: 3px solid #F59E0B; padding: 30px; }
        .certificate h1 { font-size: 2.5rem; color: #2B2D42; margin-bottom: 20px; font-family: Georgia, serif; }
        .certificate-text { font-size: 1.2rem; color: #666; line-height: 1.8; margin: 20px 0; }
        .certificate-signature { display: flex; justify-content: space-around; margin-top: 50px; }
        .certificate-sig-line { border-top: 2px solid #333; padding-top: 10px; width: 200px; font-size: 0.9rem; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: slideIn 0.4s ease-out; }
        
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 10px; text-align: center; padding: 15px; }
            .header h1 { font-size: 1.2rem; }
            .container { padding: 10px; }
            .panel { padding: 15px; }
            .lesson-title { font-size: 1.4rem; }
            .lesson-text { font-size: 1rem; }
            .btn { width: 100%; }
            .lesson-nav { flex-direction: column; }
            .lesson-progress { order: -1; text-align: center; }
            .score-big { font-size: 3rem; }
            .certificate { padding: 20px; border: 5px solid #2B2D42; }
            .flashcard-term { font-size: 1.5rem; padding: 20px; }
            .flashcard-choice { font-size: 1rem; padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>ClassClick</span> | Circular Flow Model Lab</h1>
        <div class="progress-bar">
            <div class="progress-dot active" id="dot-learn"></div>
            <span class="progress-label">Learn</span>
            <div class="progress-dot" id="dot-flashcards"></div>
            <span class="progress-label">Challenge</span>
            <div class="progress-dot" id="dot-practice"></div>
            <span class="progress-label">Practice</span>
            <div class="progress-dot" id="dot-quiz"></div>
            <span class="progress-label">Quiz</span>
        </div>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" id="tab-learn" onclick="showSection('learn')">üìö Learn</button>
            <button class="tab locked" id="tab-flashcards" onclick="showSection('flashcards')" disabled>üéØ Challenge</button>
            <button class="tab locked" id="tab-practice" onclick="showSection('practice')" disabled>üí™ Practice</button>
            <button class="tab locked" id="tab-quiz" onclick="showSection('quiz')" disabled>üìù Quiz</button>
        </div>
        
        <div class="panel active" id="panel-learn">
            <div id="lesson-container"></div>
        </div>
        
        <div class="panel" id="panel-flashcards">
            <div id="flashcards-container"></div>
        </div>
        
        <div class="panel" id="panel-practice">
            <div id="practice-container"></div>
        </div>
        
        <div class="panel" id="panel-quiz">
            <div id="quiz-container"></div>
        </div>
    </div>
    
    <div style="text-align: center; padding: 20px; color: #666; font-size: 0.85rem;">
        ClassClick by Robert Jones | ¬© 2026 | <span style="color:#bbb;font-size:10px;">SKELKEYTEC</span>
    </div>

<script>
const state = {
    currentLesson: 0,
    learnComplete: false,
    flashcardsComplete: false,
    practiceComplete: false,
    quizComplete: false,
    quizScore: 0,
    practiceRound: 0,
    practiceScore: 0,
    currentFlashcard: 0,
    flashcardScore: 0,
    flashcardStreak: 0,
    flashcardAttempts: 0
};

const urlParams = new URLSearchParams(window.location.search);
const isTeacherPreview = urlParams.get('preview') === 'true' || urlParams.get('teacher') === 'true';

if (isTeacherPreview) {
    const banner = document.createElement('div');
    banner.style.cssText = 'background:#EF4444;color:white;padding:10px;text-align:center;font-weight:bold;position:sticky;top:0;z-index:1000;';
    banner.innerHTML = 'üîì TEACHER PREVIEW MODE - All sections unlocked';
    document.body.insertBefore(banner, document.body.firstChild);
    state.learnComplete = true;
    state.flashcardsComplete = true;
    state.practiceComplete = true;
}

const lessons = [
    {
        title: "Welcome to the Circular Flow!",
        content: `<p class="lesson-text">Ever wonder how money moves through the economy? The <span class="term">Circular Flow Model</span> shows how households and businesses interact in a continuous cycle.</p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <p class="lesson-text">This diagram shows the continuous flow of money and resources between households and firms. Let's break it down step by step!</p>`
    },
    {
        title: "The Two Key Players",
        content: `<p class="lesson-text">The circular flow starts with two main players:</p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>HOUSEHOLDS (Left):</strong> That's you and your family! Households own resources (labor, land, capital) and buy goods and services. They earn income from working.</p>
        </div>
        <div class="interactive-prompt">
        <p><strong>FIRMS (Right):</strong> Businesses like Walmart, McDonald's, Apple. Firms hire workers, produce goods and services, and earn revenue from sales.</p>
        </div>`
    },
    {
        title: "Consumer Spending (Red Arrow Top)",
        content: `<p class="lesson-text">Look at the <span class="term">RED arrow at the top</span> - "Consumer expenditure"</p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>This is YOUR spending!</strong> When you buy a pizza, download a song, or buy clothes - that's consumer expenditure. Money flows FROM households TO firms.</p>
        </div>
        <p class="lesson-text"><strong>Examples:</strong> Buying groceries at Target ‚Ä¢ Paying for Netflix ‚Ä¢ Getting a haircut ‚Ä¢ Buying gas</p>`
    },
    {
        title: "Wages and Income (Red Arrow Bottom)",
        content: `<p class="lesson-text">Look at the <span class="term">RED arrow at the bottom</span> - "Wages, rent, dividends"</p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>This is YOUR income!</strong> When businesses pay you for working, that's wages. Money flows FROM firms TO households.</p>
        </div>
        <p class="lesson-text"><strong>Types of income:</strong> Wages (from working) ‚Ä¢ Rent (from owning property) ‚Ä¢ Dividends (from owning stock) ‚Ä¢ Interest (from savings)</p>`
    },
    {
        title: "Goods and Services (Black Arrow Top)",
        content: `<p class="lesson-text">Look at the <span class="term">BLACK arrow at the top</span> - "Goods and services"</p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>Physical stuff flows opposite to money!</strong> When you buy a pizza, money goes TO the firm, but the pizza comes TO you. Goods and services flow FROM firms TO households.</p>
        </div>
        <p class="lesson-text">Notice: Money and goods flow in OPPOSITE directions at the top!</p>`
    },
    {
        title: "Factors of Production (Black Arrow Bottom)",
        content: `<p class="lesson-text">Look at the <span class="term">BLACK arrow at the bottom</span> - "Factors for production"</p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>This is YOU going to work!</strong> Households provide labor, land, and capital to businesses. These resources flow FROM households TO firms.</p>
        </div>
        <p class="lesson-text"><strong>The 3 Factors:</strong> Labor (your work) ‚Ä¢ Land (natural resources, property) ‚Ä¢ Capital (tools, machines, buildings)</p>`
    },
    {
        title: "Money Flows in a Circle",
        content: `<p class="lesson-text">Now see the complete picture - <span class="term">money flows in a continuous circle!</span></p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>Follow the RED arrows:</strong><br>
        1. You spend money at stores (top red arrow) ‚Üí Firms earn revenue<br>
        2. Firms pay you wages for working (bottom red arrow) ‚Üí You earn income<br>
        3. You spend that income at stores ‚Üí The circle continues!</p>
        </div>
        <p class="lesson-text">Money never stops flowing - it goes round and round through the economy!</p>`
    },
    {
        title: "Goods Flow Opposite to Money",
        content: `<p class="lesson-text">Here's the key insight: <span class="term">Physical goods and resources flow OPPOSITE to money!</span></p>
        <div class="diagram-container">
            <img src="circular-flow-diagram.png" alt="Circular Flow Diagram" class="diagram-img">
        </div>
        <div class="interactive-prompt">
        <p><strong>Follow the BLACK arrows (opposite direction from red):</strong><br>
        1. Firms produce goods ‚Üí Goods go TO you (top black arrow)<br>
        2. You provide labor ‚Üí Your work goes TO firms (bottom black arrow)<br>
        3. Firms use your labor to make more goods ‚Üí The circle continues!</p>
        </div>
        <p class="lesson-text"><strong>Red arrows = Money clockwise</strong><br><strong>Black arrows = Goods/labor counter-clockwise</strong></p>
        <p class="lesson-text">You've mastered the circular flow! Ready for the challenge?</p>`
    }
];

const flashcards = [
    { 
        term: "Circular Flow Model", 
        definition: "A diagram showing how money and resources flow between households and firms in a continuous cycle",
        wrong1: "A chart showing supply and demand curves intersecting",
        wrong2: "A graph of stock market trends over time",
        wrong3: "A diagram of how products are manufactured"
    },
    { 
        term: "Households", 
        definition: "Individuals and families who own resources, buy goods and services, and provide labor",
        wrong1: "Government agencies that collect taxes",
        wrong2: "Banks that store money",
        wrong3: "Buildings where people live"
    },
    { 
        term: "Firms", 
        definition: "Businesses that hire workers, produce goods and services, and sell to consumers",
        wrong1: "Law offices that handle legal cases",
        wrong2: "Government organizations",
        wrong3: "Banks that lend money"
    },
    { 
        term: "Consumer Expenditure", 
        definition: "Money that households spend on goods and services (top red arrow)",
        wrong1: "Money that firms spend on advertising",
        wrong2: "Taxes paid to the government",
        wrong3: "Savings accounts at banks"
    },
    { 
        term: "Wages, Rent, Dividends", 
        definition: "Income that households earn from providing resources to firms (bottom red arrow)",
        wrong1: "Prices that consumers pay at stores",
        wrong2: "Taxes collected by government",
        wrong3: "Loans from banks"
    },
    { 
        term: "Goods and Services", 
        definition: "Products that firms sell to households (top black arrow)",
        wrong1: "Money flowing between banks",
        wrong2: "Taxes paid to government",
        wrong3: "Workers commuting to jobs"
    },
    { 
        term: "Factors of Production", 
        definition: "Resources (labor, land, capital) that households provide to firms (bottom black arrow)",
        wrong1: "Money that firms earn from sales",
        wrong2: "Products sold in stores",
        wrong3: "Government regulations on business"
    },
    { 
        term: "Product Market", 
        definition: "Where households buy goods and services from firms (top of the diagram)",
        wrong1: "Where firms buy labor from households",
        wrong2: "Where banks exchange currencies",
        wrong3: "Where stocks are traded"
    },
    { 
        term: "Resource Market", 
        definition: "Where firms hire labor and buy resources from households (bottom of the diagram)",
        wrong1: "Where consumers buy products",
        wrong2: "Where governments collect taxes",
        wrong3: "Where companies sell stock"
    },
    { 
        term: "Labor", 
        definition: "Work that people provide to businesses in exchange for wages",
        wrong1: "Tools and machines used in factories",
        wrong2: "Natural resources like oil and minerals",
        wrong3: "Money invested in businesses"
    },
    { 
        term: "Red Arrows", 
        definition: "Show money flows - clockwise direction through the economy",
        wrong1: "Show goods flowing counter-clockwise",
        wrong2: "Show government intervention",
        wrong3: "Show international trade"
    },
    { 
        term: "Black Arrows", 
        definition: "Show goods and resources - counter-clockwise, opposite to money",
        wrong1: "Show money flowing clockwise",
        wrong2: "Show government spending",
        wrong3: "Show bank transactions"
    }
];

const practiceScenarios = [
    {
        question: "You buy a burger from McDonald's for $5. What type of flow is this?",
        choices: ["Consumer expenditure (household spending)", "Wages and income (firm paying household)", "Goods and services (firm to household)", "Factors of production (household to firm)"],
        answer: "Consumer expenditure (household spending)",
        explanation: "When you spend money at a business, that's consumer expenditure - money flowing from households to firms!"
    },
    {
        question: "McDonald's pays you $15/hour to work. What type of flow is this?",
        choices: ["Consumer expenditure (household spending)", "Wages and income (firm paying household)", "Goods and services (firm to household)", "Factors of production (household to firm)"],
        answer: "Wages and income (firm paying household)",
        explanation: "When a business pays you for working, that's wages - money flowing from firms to households!"
    },
    {
        question: "McDonald's gives you the burger you paid for. What type of flow is this?",
        choices: ["Consumer expenditure (household spending)", "Wages and income (firm paying household)", "Goods and services (firm to household)", "Factors of production (household to firm)"],
        answer: "Goods and services (firm to household)",
        explanation: "When a business gives you the product, that's goods flowing from firms to households!"
    },
    {
        question: "You show up for your shift at McDonald's. What type of flow is this?",
        choices: ["Consumer expenditure (household spending)", "Wages and income (firm paying household)", "Goods and services (firm to household)", "Factors of production (household to firm)"],
        answer: "Factors of production (household to firm)",
        explanation: "When you provide your labor to a business, that's factors of production flowing from households to firms!"
    },
    {
        question: "In the circular flow model, what flows in the OPPOSITE direction from goods and services?",
        choices: ["Labor", "Land", "Money", "Capital"],
        answer: "Money",
        explanation: "Money flows in the opposite direction from goods! When goods go to you, money goes to the firm."
    },
    {
        question: "Which market involves households BUYING things from firms?",
        choices: ["Resource market", "Product market", "Labor market", "Capital market"],
        answer: "Product market",
        explanation: "The product market is where households buy goods and services from firms!"
    }
];

const quizQuestions = [
    {
        question: "What are the two main players in the circular flow model?",
        options: ["Households and Government", "Households and Firms", "Firms and Banks", "Consumers and Producers"],
        correct: 1
    },
    {
        question: "What is consumer expenditure?",
        options: ["Money households spend buying goods", "Money firms pay to workers", "Goods that firms produce", "Labor that households provide"],
        correct: 0
    },
    {
        question: "When you buy groceries at Walmart, what flows FROM you TO Walmart?",
        options: ["Goods", "Labor", "Money", "Services"],
        correct: 2
    },
    {
        question: "When you work at McDonald's, what flows FROM you TO McDonald's?",
        options: ["Money", "Your labor", "Goods", "Wages"],
        correct: 1
    },
    {
        question: "What do households provide to firms in the resource market?",
        options: ["Money to buy products", "Labor, land, and capital", "Finished goods", "Customer service"],
        correct: 1
    },
    {
        question: "What do firms provide to households in the product market?",
        options: ["Wages and salaries", "Jobs and employment", "Goods and services", "Taxes and fees"],
        correct: 2
    },
    {
        question: "When a business pays you a salary, this is an example of:",
        options: ["Consumer expenditure", "Wages and income", "Goods and services", "Factors of production"],
        correct: 1
    },
    {
        question: "Money and goods flow in __________ directions through the economy.",
        options: ["The same", "Opposite", "Random", "No specific"],
        correct: 1
    },
    {
        question: "The three factors of production are:",
        options: ["Money, goods, services", "Labor, land, capital", "Wages, rent, profit", "Households, firms, government"],
        correct: 1
    },
    {
        question: "In the circular flow model, households earn income by:",
        options: ["Buying products from firms", "Providing resources to firms", "Paying taxes to government", "Saving money in banks"],
        correct: 1
    }
];

let quizAnswers = [];

document.addEventListener('DOMContentLoaded', function() {
    renderLesson();
    if (isTeacherPreview) {
        unlockSection('flashcards');
        unlockSection('practice');
        unlockSection('quiz');
        updateProgress();
    }
});

function renderLesson() {
    const lesson = lessons[state.currentLesson];
    document.getElementById('lesson-container').innerHTML = `
        <div class="animate-in">
            <h2 class="lesson-title">${lesson.title}</h2>
            ${lesson.content}
            <div class="lesson-nav">
                <button class="btn btn-secondary" onclick="prevLesson()" ${state.currentLesson === 0 ? 'disabled' : ''}>‚Üê Back</button>
                <div class="lesson-progress">Lesson ${state.currentLesson + 1} of ${lessons.length}</div>
                <button class="btn btn-primary" onclick="nextLesson()">
                    ${state.currentLesson === lessons.length - 1 ? 'Continue to Challenge ‚Üí' : 'Next ‚Üí'}
                </button>
            </div>
        </div>
    `;
}

function nextLesson() {
    if (state.currentLesson < lessons.length - 1) {
        state.currentLesson++;
        renderLesson();
    } else {
        state.learnComplete = true;
        unlockSection('flashcards');
        showSection('flashcards');
    }
}

function prevLesson() {
    if (state.currentLesson > 0) {
        state.currentLesson--;
        renderLesson();
    }
}

function showSection(section) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    document.getElementById('panel-' + section).classList.add('active');
    document.getElementById('tab-' + section).classList.add('active');
    
    if (section === 'flashcards' && !document.getElementById('flashcards-container').innerHTML) {
        initFlashcards();
    } else if (section === 'practice' && !document.getElementById('practice-container').innerHTML) {
        initPractice();
    } else if (section === 'quiz' && !document.getElementById('quiz-container').innerHTML) {
        initQuiz();
    }
    
    updateProgress();
}

function unlockSection(section) {
    const tab = document.getElementById('tab-' + section);
    tab.disabled = false;
    tab.classList.remove('locked');
}

function updateProgress() {
    document.getElementById('dot-learn').classList.toggle('complete', state.learnComplete);
    document.getElementById('dot-flashcards').classList.toggle('complete', state.flashcardsComplete);
    document.getElementById('dot-practice').classList.toggle('complete', state.practiceComplete);
    document.getElementById('dot-quiz').classList.toggle('complete', state.quizComplete);
}

function initFlashcards() {
    state.currentFlashcard = 0;
    state.flashcardScore = 0;
    state.flashcardStreak = 0;
    state.flashcardAttempts = 0;
    renderFlashcard();
}

function renderFlashcard() {
    if (state.currentFlashcard >= flashcards.length) {
        showFlashcardComplete();
        return;
    }
    
    const card = flashcards[state.currentFlashcard];
    const container = document.getElementById('flashcards-container');
    
    // Create shuffled choices
    const choices = [
        card.definition,
        card.wrong1,
        card.wrong2,
        card.wrong3
    ].sort(() => Math.random() - 0.5);
    
    const progress = ((state.currentFlashcard / flashcards.length) * 100);
    
    container.innerHTML = `
        <div class="animate-in">
            <h2 style="text-align: center; color: #2B2D42; margin-bottom: 10px;">üéØ Knowledge Challenge</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">Choose the correct definition!</p>
            
            <div class="flashcard-header">
                <div class="flashcard-stat">
                    <div class="flashcard-stat-value">${state.currentFlashcard + 1}/${flashcards.length}</div>
                    <div class="flashcard-stat-label">Card</div>
                </div>
                <div class="flashcard-stat">
                    <div class="flashcard-stat-value">${state.flashcardScore}</div>
                    <div class="flashcard-stat-label">Score</div>
                </div>
                <div class="flashcard-stat">
                    <div class="flashcard-stat-value">${state.flashcardStreak}</div>
                    <div class="flashcard-stat-label">Streak</div>
                </div>
            </div>
            
            <div class="flashcard-progress-bar">
                <div class="flashcard-progress-fill" style="width: ${progress}%"></div>
            </div>
            
            ${state.flashcardStreak >= 3 ? `<div class="flashcard-streak"><span class="streak-fire">üî•</span> ${state.flashcardStreak} in a row! <span class="streak-fire">üî•</span></div>` : ''}
            
            <div class="flashcard-challenge">
                <div class="flashcard-term">${card.term}</div>
                <div class="flashcard-question">What is this?</div>
                <div class="flashcard-choices">
                    ${choices.map(choice => `
                        <button class="flashcard-choice" onclick="checkFlashcard('${choice.replace(/'/g, "\\'")}', '${card.definition.replace(/'/g, "\\'")}')">${choice}</button>
                    `).join('')}
                </div>
                <div id="flashcard-feedback"></div>
            </div>
        </div>
    `;
}

function checkFlashcard(selected, correct) {
    state.flashcardAttempts++;
    const isCorrect = selected === correct;
    
    // Disable all choices
    document.querySelectorAll('.flashcard-choice').forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correct) {
            btn.classList.add('correct');
        } else if (btn.textContent === selected && !isCorrect) {
            btn.classList.add('incorrect');
        }
    });
    
    const feedbackEl = document.getElementById('flashcard-feedback');
    
    if (isCorrect) {
        state.flashcardScore += 10;
        state.flashcardStreak++;
        
        if (state.flashcardStreak >= 3) {
            state.flashcardScore += 5; // Bonus for streak!
        }
        
        feedbackEl.innerHTML = `
            <div class="flashcard-feedback correct">
                ‚úì Correct! ${state.flashcardStreak >= 3 ? '+15 points (10 + 5 streak bonus!)' : '+10 points'}
            </div>
            <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="nextFlashcard()">Next Card ‚Üí</button>
        `;
    } else {
        state.flashcardStreak = 0;
        feedbackEl.innerHTML = `
            <div class="flashcard-feedback incorrect">
                ‚úó Not quite. Try again!
            </div>
        `;
        
        // Re-enable only the correct answer and unselected wrong answers
        document.querySelectorAll('.flashcard-choice').forEach(btn => {
            if (!btn.classList.contains('incorrect')) {
                btn.disabled = false;
            }
        });
    }
}

function nextFlashcard() {
    state.currentFlashcard++;
    renderFlashcard();
}

function showFlashcardComplete() {
    const container = document.getElementById('flashcards-container');
    const accuracy = Math.round((flashcards.length / state.flashcardAttempts) * 100);
    
    let rating = '';
    if (accuracy >= 90) rating = '‚≠ê‚≠ê‚≠ê PERFECT!';
    else if (accuracy >= 75) rating = '‚≠ê‚≠ê GREAT!';
    else if (accuracy >= 60) rating = '‚≠ê GOOD!';
    else rating = 'COMPLETE!';
    
    container.innerHTML = `
        <div class="score-screen animate-in">
            <h2 style="color: #2B2D42;">üèÜ Challenge Complete!</h2>
            <div class="score-big">${state.flashcardScore}</div>
            <div class="score-label">Total Points</div>
            
            <div style="display: flex; justify-content: center; gap: 40px; margin: 30px 0; flex-wrap: wrap;">
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: #14B8A6;">${accuracy}%</div>
                    <div style="color: #666;">Accuracy</div>
                </div>
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: #F59E0B;">${state.flashcardAttempts}</div>
                    <div style="color: #666;">Attempts</div>
                </div>
            </div>
            
            <div style="font-size: 2rem; margin: 20px 0;">${rating}</div>
            
            <button class="btn btn-primary" onclick="completeFlashcards()">Continue to Practice ‚Üí</button>
            <button class="btn btn-secondary" style="margin-left: 10px; margin-top: 10px;" onclick="initFlashcards()">Try Again</button>
        </div>
    `;
}

function completeFlashcards() {
    state.flashcardsComplete = true;
    unlockSection('practice');
    showSection('practice');
}

function initPractice() {
    state.practiceRound = 0;
    state.practiceScore = 0;
    renderPractice();
}

function renderPractice() {
    if (state.practiceRound >= practiceScenarios.length) {
        showPracticeComplete();
        return;
    }
    
    const scenario = practiceScenarios[state.practiceRound];
    const container = document.getElementById('practice-container');
    
    container.innerHTML = `
        <div class="animate-in">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                <span style="font-size: 1.2rem; font-weight: bold;">Question ${state.practiceRound + 1} of ${practiceScenarios.length}</span>
                <span style="font-size: 1.2rem; font-weight: bold; color: #F59E0B;">Score: ${state.practiceScore}</span>
            </div>
            
            <div class="practice-scenario">
                <h3>${scenario.question}</h3>
                <div class="btn-row" style="margin-top: 20px;">
                    ${scenario.choices.map(choice => 
                        `<button class="btn-small" onclick="submitPractice(\`${choice}\`)">${choice}</button>`
                    ).join('')}
                </div>
            </div>
            <div id="practice-feedback"></div>
        </div>
    `;
}

function submitPractice(answer) {
    const scenario = practiceScenarios[state.practiceRound];
    const correct = answer === scenario.answer;
    
    if (correct) state.practiceScore += 20;
    
    document.getElementById('practice-feedback').innerHTML = `
        <div class="feedback ${correct ? 'correct' : 'incorrect'}">
            ${correct ? '‚úÖ Correct!' : '‚ùå Incorrect.'} ${scenario.explanation}
        </div>
        <button class="btn btn-primary" style="margin-top: 15px;" onclick="nextPractice()">Next Question ‚Üí</button>
    `;
    
    document.querySelectorAll('.btn-small').forEach(b => b.disabled = true);
}

function nextPractice() {
    state.practiceRound++;
    renderPractice();
}

function showPracticeComplete() {
    const container = document.getElementById('practice-container');
    const percent = Math.round((state.practiceScore / (practiceScenarios.length * 20)) * 100);
    
    container.innerHTML = `
        <div class="score-screen animate-in">
            <h2 style="color: #2B2D42;">üèÜ Practice Complete!</h2>
            <div class="score-big">${state.practiceScore}</div>
            <div class="score-label">out of ${practiceScenarios.length * 20} points (${percent}%)</div>
            
            <button class="btn btn-primary" onclick="completePractice()">Continue to Quiz ‚Üí</button>
            <button class="btn btn-secondary" style="margin-left: 10px; margin-top: 10px;" onclick="initPractice()">Try Again</button>
        </div>
    `;
}

function completePractice() {
    state.practiceComplete = true;
    unlockSection('quiz');
    showSection('quiz');
}

function initQuiz() {
    quizAnswers = [];
    renderQuiz();
}

function renderQuiz() {
    const container = document.getElementById('quiz-container');
    
    container.innerHTML = `
        <div class="animate-in">
            <h2 style="color: #2B2D42; margin-bottom: 10px;">üìù Circular Flow Quiz</h2>
            <p style="color: #666; margin-bottom: 20px;">Test your understanding of circular flow concepts!</p>
            
            <div id="quiz-questions"></div>
            
            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="submitQuiz()" id="submit-quiz-btn">Submit Quiz</button>
        </div>
    `;
    
    const questionsContainer = document.getElementById('quiz-questions');
    quizQuestions.forEach((q, i) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'quiz-question';
        questionDiv.innerHTML = `
            <h3>Question ${i + 1}</h3>
            <p>${q.question}</p>
            <div class="quiz-options">
                ${q.options.map((opt, j) => `
                    <div class="quiz-option" onclick="selectQuizAnswer(${i}, ${j})" data-question="${i}" data-option="${j}">
                        ${opt}
                    </div>
                `).join('')}
            </div>
        `;
        questionsContainer.appendChild(questionDiv);
    });
}

function selectQuizAnswer(questionIndex, optionIndex) {
    const options = document.querySelectorAll(`[data-question="${questionIndex}"]`);
    options.forEach(opt => opt.classList.remove('selected'));
    options[optionIndex].classList.add('selected');
    
    quizAnswers[questionIndex] = optionIndex;
}

function submitQuiz() {
    if (quizAnswers.length < quizQuestions.length) {
        alert('Please answer all questions!');
        return;
    }
    
    quizQuestions.forEach((q, i) => {
        const options = document.querySelectorAll(`[data-question="${i}"]`);
        options.forEach((opt, j) => {
            if (j === q.correct) {
                opt.classList.add('correct');
            } else if (j === quizAnswers[i] && j !== q.correct) {
                opt.classList.add('incorrect');
            }
            opt.onclick = null;
        });
    });
    
    document.getElementById('submit-quiz-btn').disabled = true;
    
    setTimeout(showQuizResults, 1000);
}

function showQuizResults() {
    const correct = quizAnswers.filter((ans, i) => ans === quizQuestions[i].correct).length;
    const percent = Math.round((correct / quizQuestions.length) * 100);
    state.quizScore = correct;
    state.quizComplete = true;
    updateProgress();
    
    const container = document.getElementById('quiz-container');
    container.innerHTML = `
        <div class="score-screen animate-in">
            <h2 style="color: #2B2D42;">üìù Quiz Complete!</h2>
            <div class="score-big">${correct}/${quizQuestions.length}</div>
            <div class="score-label">${percent}%</div>
            
            <button class="btn btn-primary" onclick="showCertificate()">üéì Get Your Certificate</button>
        </div>
    `;
}

function showCertificate() {
    const correct = state.quizScore;
    const percent = Math.round((correct / quizQuestions.length) * 100);
    const date = new Date().toLocaleDateString();
    
    const container = document.getElementById('quiz-container');
    container.innerHTML = `
        <div class="animate-in">
            <div class="certificate">
                <div class="certificate-border">
                    <h1>üéì Certificate of Completion</h1>
                    
                    <div class="certificate-text">This certifies that</div>
                    
                    <div style="margin: 20px 0;">
                        <input type="text" id="cert-name" placeholder="Enter Your Name" 
                               style="font-size: 2rem; padding: 15px; text-align: center; width: 80%; max-width: 500px; border: 2px solid #F59E0B; border-radius: 8px;">
                    </div>
                    
                    <div class="certificate-text">
                        has successfully completed the<br>
                        <strong style="color: #F59E0B; font-size: 1.5rem;">Circular Flow Model Interactive Lab</strong>
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; margin: 40px 0; padding: 20px; background: #F8F8F8; border-radius: 8px; flex-wrap: wrap; gap: 20px;">
                        <div style="min-width: 120px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #F59E0B;">${correct}/${quizQuestions.length}</div>
                            <div style="color: #666;">Quiz Score</div>
                        </div>
                        <div style="min-width: 120px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #F59E0B;">${percent}%</div>
                            <div style="color: #666;">Accuracy</div>
                        </div>
                        <div style="min-width: 120px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #F59E0B;">${date}</div>
                            <div style="color: #666;">Date</div>
                        </div>
                    </div>
                    
                    <div class="certificate-text" style="margin-top: 30px;">
                        Demonstrating mastery of circular flow concepts,<br>
                        markets, and economic interactions
                    </div>
                    
                    <div class="certificate-signature">
                        <div class="certificate-sig-line">
                            Robert Jones<br>
                            <small>ClassClick Economics</small>
                        </div>
                        <div class="certificate-sig-line">
                            ${date}<br>
                            <small>Date</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn btn-primary" onclick="printCertificate()">üñ®Ô∏è Print Certificate</button>
            </div>
        </div>
    `;
}

function printCertificate() {
    const name = document.getElementById('cert-name').value || 'Student Name';
    const correct = state.quizScore;
    const percent = Math.round((correct / quizQuestions.length) * 100);
    const date = new Date().toLocaleDateString();
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Certificate of Completion</title>
            <style>
                body { font-family: Georgia, serif; padding: 40px; }
                .certificate { border: 10px solid #2B2D42; padding: 40px; text-align: center; max-width: 800px; margin: 0 auto; }
                .certificate-border { border: 3px solid #F59E0B; padding: 30px; }
                h1 { font-size: 2.5rem; color: #2B2D42; margin-bottom: 20px; }
                .cert-name { font-size: 3rem; color: #F59E0B; font-weight: bold; margin: 30px 0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
                .cert-text { font-size: 1.2rem; color: #666; line-height: 1.8; margin: 20px 0; }
                .scores { display: flex; justify-content: space-around; margin: 40px 0; }
                .score-value { font-size: 2rem; font-weight: bold; color: #F59E0B; }
                .signatures { display: flex; justify-content: space-around; margin-top: 50px; }
                .sig-line { border-top: 2px solid #333; padding-top: 10px; width: 200px; }
            </style>
        </head>
        <body>
            <div class="certificate">
                <div class="certificate-border">
                    <h1>üéì Certificate of Completion</h1>
                    <div class="cert-text">This certifies that</div>
                    <div class="cert-name">${name}</div>
                    <div class="cert-text">
                        has successfully completed the<br>
                        <strong style="color: #F59E0B; font-size: 1.5rem;">Circular Flow Model Interactive Lab</strong>
                    </div>
                    <div class="scores">
                        <div><div class="score-value">${correct}/${quizQuestions.length}</div><div>Quiz Score</div></div>
                        <div><div class="score-value">${percent}%</div><div>Accuracy</div></div>
                        <div><div class="score-value">${date}</div><div>Date</div></div>
                    </div>
                    <div class="cert-text">
                        Demonstrating mastery of circular flow concepts,<br>
                        markets, and economic interactions
                    </div>
                    <div class="signatures">
                        <div class="sig-line">Robert Jones<br><small>ClassClick Economics</small></div>
                        <div class="sig-line">${date}<br><small>Date</small></div>
                    </div>
                </div>
            </div>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}
</script>
</body>
</html>
