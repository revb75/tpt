<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISLAND ECONOMIST | PPF Learning Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: linear-gradient(135deg, #0a4a3a 0%, #1a3a4a 100%);
            color: #00ff88;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #0a0a0a;
            border: 3px solid #00ff88;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00ff88;
        }
        
        .header h1 {
            font-size: 2rem;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
            margin-bottom: 10px;
        }
        
        .day-tracker {
            background: #1a1a00;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #ffcc00;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .time-bar {
            background: #1a1a1a;
            border: 2px solid #00ccff;
            height: 40px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .time-fill {
            background: linear-gradient(90deg, #00ccff, #0088cc);
            height: 100%;
            width: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .health-bar {
            background: #1a1a1a;
            border: 2px solid #ff3366;
            height: 35px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .health-fill {
            background: linear-gradient(90deg, #ff3366, #cc0033);
            height: 100%;
            width: 100%;
            transition: width 0.5s, background 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 1rem;
            text-shadow: 0 0 5px #000;
        }
        
        .health-fill.healthy {
            background: linear-gradient(90deg, #00ff88, #00cc66);
        }
        
        .health-fill.warning {
            background: linear-gradient(90deg, #ffcc00, #ff8800);
        }
        
        .health-fill.critical {
            background: linear-gradient(90deg, #ff3366, #cc0033);
            animation: pulse-health 1s infinite;
        }
        
        @keyframes pulse-health {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .output {
            min-height: 500px;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            line-height: 1.8;
            padding: 20px;
            background: #000;
            border: 2px solid #003322;
        }
        
        .output p { margin: 12px 0; }
        
        .vocab-box {
            background: #1a1a00;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin: 15px 0;
            line-height: 1.8;
        }
        
        .vocab-term {
            color: #ffcc00;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .vocab-def {
            color: #00ff88;
            margin-left: 20px;
        }
        
        .location {
            color: #ffcc00;
            font-size: 1.4rem;
            font-weight: bold;
            margin: 25px 0 15px 0;
            text-align: center;
            border-top: 2px solid #ffcc00;
            border-bottom: 2px solid #ffcc00;
            padding: 10px 0;
        }
        
        .exits {
            background: #1a1a1a;
            border: 2px solid #00ccff;
            padding: 12px;
            margin: 15px 0;
            color: #00ccff;
            font-weight: bold;
        }
        
        .lesson-header {
            background: #1a1a00;
            border: 3px solid #ffcc00;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #ffcc00;
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .lesson-content {
            background: #0a0a0a;
            border: 2px solid #00ff88;
            padding: 20px;
            margin: 15px 0;
            line-height: 1.9;
        }
        
        .graph-container {
            background: #000;
            border: 2px solid #00ff88;
            padding: 25px;
            margin: 20px auto;
        }
        
        .graph-title {
            color: #ffcc00;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background: #000;
            border: 1px solid #003322;
        }
        
        .graph-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #00ff88;
            font-size: 0.9rem;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .action { color: #00ccff; font-weight: bold; }
        .warning { color: #ffaa00; font-weight: bold; }
        .danger { color: #ff4444; font-weight: bold; }
        .success { color: #00ff88; font-weight: bold; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: #1a1a1a;
            border: 2px solid #00ff88;
            padding: 15px;
            text-align: center;
        }
        
        .stat-label {
            color: #00ff88;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #ffffff;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
        }
        
        #commandInput {
            flex: 1;
            background: #000;
            border: 2px solid #00ff88;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            padding: 15px;
        }
        
        #commandInput:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }
        
        button:hover {
            background: #00cc66;
        }
        
        .hint-box {
            background: #1a1a00;
            border: 2px solid #ffcc00;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .game-container { padding: 15px; }
            .header h1 { font-size: 1.5rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            canvas { width: 100% !important; height: auto !important; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üèùÔ∏è ISLAND ECONOMIST üèùÔ∏è</h1>
            <div>Production Possibilities Frontier Adventure</div>
            <div style="color:#00ccff;margin-top:10px;">ClassClick Economics</div>
        </div>
        
        <div class="day-tracker" id="dayTracker" style="display:none;">DAY 1</div>
        
        <div class="time-bar" style="display:none;">
            <div class="time-fill" id="timeFill">‚è∞ 10 HOURS</div>
        </div>
        
        <div class="health-bar" style="display:none;">
            <div class="health-fill healthy" id="healthFill">‚ù§Ô∏è 100% HEALTH</div>
        </div>
        
        <div class="stats-grid" id="statsGrid" style="display:none;">
            <div class="stat-box">
                <div class="stat-label">üêü FISH</div>
                <div class="stat-value" id="fishCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ü™µ WOOD</div>
                <div class="stat-value" id="woodCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">üî• FIRES</div>
                <div class="stat-value" id="fireCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">üõñ WALLS</div>
                <div class="stat-value" id="wallsCount">0</div>
            </div>
        </div>
        
        <div class="output" id="output"></div>
        
        <div class="input-area">
            <input type="text" id="commandInput" placeholder="Press ENTER to start..." autofocus>
            <button onclick="processCommand()">ENTER</button>
        </div>
        
        <div class="hint-box" id="helpBox">Press ENTER to begin</div>
    </div>

<script>
// GAME STATE
let gameState = {
    phase: 'intro',
    vocabStep: 0,
    day: 1,
    hoursRemaining: 10,
    currentLocation: 'camp',
    fish: 0, wood: 0, fires: 0, walls: 0,
    health: 100, // NEW: Health system (0-100)
    fishEatenToday: 0, // Track daily food
    hadFireToday: false, // Track daily warmth
    fishingRate: 2, gatheringRate: 1, fireRate: 1, buildingRate: 3,
    hasNet: false,
    dayActions: [],
    currentLessonQuestion: null,
    quizAnswers: [] // Track student answers
};

const locations = {
    camp: { name: "CAMP", desc: "Your makeshift shelter (${walls} walls complete). Fire pit${fireDesc}. Tarp strung between palms. Safety. For now.", exits: ['BEACH', 'FOREST', 'CLIFF'], actions: ['BUILD', 'FIRE'] },
    beach: { name: "BEACH", desc: "White sand. Turquoise water. Plane wreckage offshore.${netDesc} Old footprints leading to surf - washed away by tide.", exits: ['CAMP'], actions: ['FISH'] },
    forest: { name: "FOREST", desc: "Dense jungle. Coconut palms. Bamboo. Wood everywhere. Something moved in the shadows - just a crab. Probably.", exits: ['CAMP', 'CLIFF'], actions: ['GATHER'] },
    cliff: { name: "CLIFF", desc: "Rocky outcrop overlooking ocean. Carved into stone: '47 DAYS'. Someone counted. Your journal rests here. How long did they wait?", exits: ['CAMP', 'FOREST'], actions: ['MAP'] }
};

// QUIZ QUESTIONS (Answer Key: B, B, C, B, A)
const quizQuestions = [
    {
        day: 1,
        question: "Using only 7 out of 10 hours means you're:",
        options: ["A) EFFICIENT (on the frontier)", "B) INEFFICIENT (inside, wasting 3 hours)", "C) Beyond the frontier (impossible)"],
        correct: 'B',
        explanation: "INEFFICIENT = wasting resources = INSIDE the frontier!"
    },
    {
        day: 2,
        question: "A point INSIDE the PPF curve means:",
        options: ["A) Using all resources efficiently", "B) Wasting some resources", "C) Producing more than possible"],
        correct: 'B',
        explanation: "Inside the curve = not using all available time/resources = INEFFICIENT!"
    },
    {
        day: 3,
        question: "When a country has 10% unemployment, it is:",
        options: ["A) On the PPF", "B) Outside the PPF", "C) Inside the PPF"],
        correct: 'C',
        explanation: "Unemployed workers = wasted labor! The economy could produce MORE = INSIDE PPF!"
    },
    {
        day: 4,
        question: "Finding the fishing net shifted your PPF. This represents:",
        options: ["A) Inefficiency", "B) Economic growth", "C) Opportunity cost"],
        correct: 'B',
        explanation: "Better technology = more productive = PPF shifts OUTWARD = ECONOMIC GROWTH!"
    },
    {
        day: 5,
        question: "If you build 1 wall (3 hrs) instead of fishing, your opportunity cost is:",
        options: ["A) 1.5 fish (with 2hr rate)", "B) 1 wall", "C) 3 hours"],
        correct: 'A',
        explanation: "3 hours could catch 1.5 fish (3√∑2=1.5). That's what you GAVE UP = opportunity cost!"
    }
];

// VOCABULARY TUTORIAL
const vocabSteps = [
    () => {
        clearScreen();
        print("<span class='success' style='font-size:1.5rem;'>ISLAND ECONOMIST</span>");
        print("");
        print("<span class='danger'>‚ö†Ô∏è TRANSMISSION INTERCEPTED ‚ö†Ô∏è</span>");
        print("");
        print("Dr. Sarah Chen. Economics professor. En route to research conference.");
        print("Plane went down in storm. Mayday. Coordinates: unknown.");
        print("Washed ashore on small island. Wreckage offshore.");
        print("");
        print("<span class='warning'>RESCUE ETA: 5 days if signal received.</span>");
        print("");
        print("You have your journal. Your knowledge. Limited time.");
        print("You'll survive on this island for 5 days.");
        print("");
        print("But first, let's review the VOCABULARY you'll need...");
        print("");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö VOCABULARY: SCARCITY</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>SCARCITY</span>");
        print("<div class='vocab-def'>SCARCE = not enough, limited</div>");
        print("<div class='vocab-def'>-ITY = the condition of being</div>");
        print("");
        print("<span class='success'>SCARCITY = the condition of not having enough</span>");
        print("</div>");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö VOCABULARY: PRODUCTION</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>PRODUCTION</span>");
        print("<div class='vocab-def'>PRODUCE = to make, create</div>");
        print("<div class='vocab-def'>-TION = the act of</div>");
        print("");
        print("<span class='success'>PRODUCTION = the act of making things</span>");
        print("</div>");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö VOCABULARY: POSSIBILITIES</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>POSSIBILITIES</span>");
        print("<div class='vocab-def'>POSSIBLE = could happen, able to be done</div>");
        print("<div class='vocab-def'>-ITIES = plural, many options</div>");
        print("");
        print("<span class='success'>POSSIBILITIES = all the different options</span>");
        print("</div>");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö VOCABULARY: FRONTIER</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>FRONTIER</span>");
        print("<div class='vocab-def'>FRONTIER = edge, boundary, limit</div>");
        print("");
        print("<span class='success'>FRONTIER = the LIMIT of what's possible</span>");
        print("</div>");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö PUTTING IT TOGETHER</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>PRODUCTION POSSIBILITIES FRONTIER (PPF)</span>");
        print("");
        print("<span class='action'>PRODUCTION</span> = what you make");
        print("<span class='action'>POSSIBILITIES</span> = all your options");
        print("<span class='action'>FRONTIER</span> = the LIMIT");
        print("");
        print("<span class='success'>PPF = THE LIMIT OF WHAT YOU CAN PRODUCE</span>");
        print("</div>");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö VOCABULARY: OPPORTUNITY COST</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>OPPORTUNITY COST</span>");
        print("<div class='vocab-def'>OPPORTUNITY = a chance to do something</div>");
        print("<div class='vocab-def'>COST = what you give up</div>");
        print("");
        print("<span class='success'>OPPORTUNITY COST = what you GIVE UP when you choose</span>");
        print("</div>");
        print("<span class='action'>Press ENTER...</span>");
    },
    () => {
        clearScreen();
        print("<div class='lesson-header'>üìö VOCABULARY: EFFICIENT vs INEFFICIENT</div>");
        print("<div class='vocab-box'>");
        print("<span class='vocab-term'>EFFICIENT = using all resources wisely, no waste</span>");
        print("<span class='vocab-term'>INEFFICIENT = wasting resources</span>");
        print("</div>");
        print("<span class='action'>Press ENTER to start Day 1...</span>");
    },
    () => { startDay1(); }
];

function runVocabTutorial() {
    if (gameState.vocabStep < vocabSteps.length) {
        vocabSteps[gameState.vocabStep]();
        gameState.vocabStep++;
    }
}

// PPF GRAPH
function drawPPFGraph(yourFish = 0, yourWalls = 0, showOld = false) {
    const output = document.getElementById('output');
    const container = document.createElement('div');
    container.className = 'graph-container';
    container.innerHTML = `
        <div class="graph-title">üìä PRODUCTION POSSIBILITIES FRONTIER</div>
        <canvas id="ppfCanvas" width="800" height="500"></canvas>
    `;
    output.appendChild(container);
    
    setTimeout(() => {
        const canvas = document.getElementById('ppfCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = 800, H = 500, PAD = 80;
        const GW = W - PAD * 2, GH = H - PAD * 2;
        
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, W, H);
        
        const maxF = 10 / gameState.fishingRate;
        const maxW = 10 / gameState.buildingRate;
        
        function toCanvas(f, w) {
            return { x: PAD + (f / maxF) * GW, y: H - PAD - (w / maxW) * GH };
        }
        function ppf(f) { return maxW * (1 - f / maxF); }
        
        // Grid
        ctx.strokeStyle = '#1a3a3a';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const x = PAD + (GW / 5) * i;
            ctx.beginPath(); ctx.moveTo(x, PAD); ctx.lineTo(x, H - PAD); ctx.stroke();
            const y = PAD + (GH / 5) * i;
            ctx.beginPath(); ctx.moveTo(PAD, y); ctx.lineTo(W - PAD, y); ctx.stroke();
        }
        
        // Axes
        ctx.strokeStyle = '#00ccff';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(PAD, H - PAD); ctx.lineTo(PAD, PAD);
        ctx.moveTo(PAD, H - PAD); ctx.lineTo(W - PAD, H - PAD);
        ctx.stroke();
        
        // Labels
        ctx.fillStyle = '#00ff88';
        ctx.font = 'bold 15px Courier New';
        ctx.textAlign = 'center';
        ctx.fillText('PRODUCTION: FISH', W / 2, H - 25);
        ctx.save();
        ctx.translate(25, H / 2); ctx.rotate(-Math.PI / 2);
        ctx.fillText('PRODUCTION: WALLS', 0, 0);
        ctx.restore();
        
        // Numbers
        ctx.fillStyle = '#00ccff';
        ctx.font = '12px Courier New';
        for (let i = 0; i <= Math.ceil(maxF); i++) {
            const x = PAD + (i / maxF) * GW;
            ctx.textAlign = 'center';
            ctx.fillText(i, x, H - PAD + 18);
        }
        for (let i = 0; i <= Math.ceil(maxW); i++) {
            const y = H - PAD - (i / maxW) * GH;
            ctx.textAlign = 'right';
            ctx.fillText(i.toFixed(1), PAD - 12, y + 4);
        }
        
        // Old curve (if tech upgrade)
        if (showOld) {
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            for (let f = 0; f <= 5; f += 0.1) {
                const w = maxW * (1 - f / 5);
                const p = toCanvas(f, w);
                if (f === 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // PPF curve
        ctx.strokeStyle = '#00ff88';
        ctx.lineWidth = 3;
        ctx.beginPath();
        for (let f = 0; f <= maxF; f += 0.05) {
            const w = ppf(f);
            const p = toCanvas(f, w);
            if (f === 0) ctx.moveTo(p.x, p.y);
            else ctx.lineTo(p.x, p.y);
        }
        ctx.stroke();
        
        // Your point
        if (yourFish > 0 || yourWalls > 0) {
            const p = toCanvas(yourFish, yourWalls);
            ctx.fillStyle = '#ff0000';
            ctx.beginPath(); ctx.arc(p.x, p.y, 8, 0, Math.PI * 2); ctx.fill();
            ctx.strokeStyle = '#ff0000'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(p.x + 45, p.y - 35); ctx.lineTo(p.x + 12, p.y - 12); ctx.stroke();
            ctx.fillStyle = '#ff0000';
            ctx.beginPath(); ctx.moveTo(p.x + 12, p.y - 12); ctx.lineTo(p.x + 18, p.y - 16); ctx.lineTo(p.x + 15, p.y - 8); ctx.closePath(); ctx.fill();
            ctx.font = 'bold 14px Courier New';
            ctx.textAlign = 'left';
            ctx.fillText('YOU!', p.x + 50, p.y - 38);
        }
    }, 100);
}

// UTILITY
function print(text) {
    const p = document.createElement('p');
    p.innerHTML = text;
    document.getElementById('output').appendChild(p);
    document.getElementById('output').scrollTop = document.getElementById('output').scrollHeight;
}
function clearScreen() { document.getElementById('output').innerHTML = ''; }
function updateDisplay() {
    document.getElementById('dayTracker').textContent = `DAY ${gameState.day} of 5`;
    document.getElementById('timeFill').textContent = `‚è∞ ${gameState.hoursRemaining} HRS`;
    document.getElementById('timeFill').style.width = (gameState.hoursRemaining / 10 * 100) + '%';
    
    // Update health bar
    const healthPercent = Math.max(0, Math.min(100, Math.round(gameState.health)));
    document.getElementById('healthFill').textContent = `‚ù§Ô∏è ${healthPercent}% HEALTH`;
    document.getElementById('healthFill').style.width = (healthPercent) + '%';
    
    // Change health bar color based on health level
    const healthFill = document.getElementById('healthFill');
    healthFill.className = 'health-fill';
    if (healthPercent >= 70) healthFill.classList.add('healthy');
    else if (healthPercent >= 40) healthFill.classList.add('warning');
    else healthFill.classList.add('critical');
    
    document.getElementById('fishCount').textContent = gameState.fish;
    document.getElementById('woodCount').textContent = gameState.wood;
    document.getElementById('fireCount').textContent = gameState.fires;
    document.getElementById('wallsCount').textContent = gameState.walls.toFixed(1);
}
function showGameUI() {
    document.getElementById('dayTracker').style.display = 'block';
    document.querySelector('.time-bar').style.display = 'block';
    document.querySelector('.health-bar').style.display = 'block';
    document.getElementById('statsGrid').style.display = 'grid';
}

// GAME COMMANDS
function processCommand() {
    const input = document.getElementById('commandInput');
    let cmd = input.value.trim().toUpperCase();
    input.value = '';
    
    if (gameState.phase === 'intro') { runVocabTutorial(); return; }
    if (gameState.phase === 'wait') {
        if (cmd === '' || cmd === 'ENTER' || cmd === 'CONTINUE') {
            if (gameState.nextPhase) {
                gameState.phase = gameState.nextPhase;
                gameState.nextPhase = null;
                if (gameState.phase === 'playing') startDay();
                else if (gameState.phase === 'lesson') showLesson();
                else if (gameState.phase === 'quiz') showQuiz();
            }
        }
        return;
    }
    if (gameState.phase === 'quiz') { checkAnswer(cmd); return; }
    if (gameState.phase === 'playing') {
        if (!cmd) return;
        print(`<span style='color:#00ccff;'>></span> ${cmd}`);
        const verb = cmd.split(' ')[0];
        const arg = cmd.split(' ').slice(1).join(' ');
        if (verb === 'HELP') showHelp();
        else if (verb === 'LOOK' || verb === 'L') lookRoom();
        else if (verb === 'GO' || ['CAMP', 'BEACH', 'FOREST', 'CLIFF'].includes(verb)) go(verb === 'GO' ? arg : verb);
        else if (verb === 'FISH') doFish();
        else if (verb === 'GATHER') doGather();
        else if (verb === 'BUILD') doBuild();
        else if (verb === 'FIRE') doFire();
        else if (verb === 'EAT') doEat();
        else if (verb === 'STATUS' || verb === 'I') showStatus();
        else if (verb === 'MAP') showMap();
        else if (verb === 'SLEEP' || verb === 'END') endDay();
        else print("<span class='danger'>? Type HELP</span>");
    }
}

function startDay1() {
    clearScreen();
    showGameUI();
    updateDisplay();
    print("<span class='warning' style='font-size:1.3rem;'>‚òÄÔ∏è DAY 1 of 5 ‚òÄÔ∏è</span>");
    print("");
    print("<span class='danger'>You wake on the beach, coughing salt water.</span>");
    print("Plane wreckage floats in the distance. No sign of other survivors.");
    print("Your journal survived. You're trained for this - economics is about scarcity.");
    print("<span class='action'>Survive. Build shelter. Wait for rescue.</span>");
    print("");
    print("Now EXPERIENCE the vocabulary you reviewed!");
    print("You have <span class='warning'>10 hours of daylight</span> (SCARCITY).");
    print("Every choice has an <span class='warning'>OPPORTUNITY COST</span>.");
    print("Your production is limited by the <span class='warning'>PPF</span>.");
    print("");
    print("<span class='action'>GOAL: Survive 5 days. Build 3 walls by Day 5!</span>");
    print("");
    print("Type <span class='action'>LOOK</span>");
    gameState.phase = 'playing';
    document.getElementById('helpBox').innerHTML = 'LOOK | GO | FISH | GATHER | BUILD | FIRE | EAT | SLEEP';
}

function startDay() {
    clearScreen();
    showGameUI();
    updateDisplay();
    print(`<span class='warning' style='font-size:1.3rem;'>‚òÄÔ∏è DAY ${gameState.day} of 5 ‚òÄÔ∏è</span>`);
    print("");
    
    // Daily story narratives
    if (gameState.day === 1) {
        print("<span class='danger'>You wake on the beach, coughing salt water.</span>");
        print("Plane wreckage floats in the distance. No sign of other survivors.");
        print("Your journal survived. You're trained for this - economics is about scarcity.");
        print("<span class='action'>Survive. Build shelter. Wait for rescue.</span>");
    }
    else if (gameState.day === 2) {
        print("Dawn breaks. You slept restlessly.");
        print("Found footprints near camp this morning. Old. Weathered.");
        print("<span class='warning'>Someone else was here once.</span>");
    }
    else if (gameState.day === 3) {
        print("Third day. Body aches from labor.");
        print("Radio crackle from wreckage - garbled rescue transmission.");
        print("<span class='danger'>‚ö†Ô∏è STORM WARNING! Need 3 walls by Day 5!</span>");
        print("Five days. They said five days. Two more to go.");
    }
    else if (gameState.day === 4) {
        print("Day four. Clouds gathering on horizon.");
        print("Found an old SOS flag near the beach. Faded. How long was it there?");
        print("<span class='warning'>üí° Explore the BEACH for supplies!</span>");
        print("Tomorrow the storm hits. Are you ready?");
    }
    else if (gameState.day === 5) {
        print("<span class='danger'>FINAL DAY. Storm clouds black overhead.</span>");
        print("Wind picking up. Waves crashing harder.");
        print("<span class='danger'>‚ö†Ô∏è STORM TONIGHT! This is it!</span>");
        print("By dawn, either rescue arrives... or you face another week alone.");
    }
    
    print("");
    print("Type LOOK");
}

function showHelp() {
    print("");
    print("MOVEMENT: GO CAMP | GO BEACH | GO FOREST | GO CLIFF");
    print("ACTIONS: FISH (2hrs) | GATHER (1hr) | BUILD (3hrs) | FIRE (1hr)");
    print("SURVIVAL: EAT (consume fish, restore health +15%)");
    print("<span class='warning'>‚ö†Ô∏è Health drops without food & warmth!</span>");
    print("INFO: LOOK | STATUS | MAP | SLEEP");
}

function lookRoom() {
    const loc = locations[gameState.currentLocation];
    print("");
    print(`<span class='location'>${loc.name}</span>`);
    let d = loc.desc;
    d = d.replace('${walls}', gameState.walls.toFixed(1));
    d = d.replace('${fireDesc}', gameState.fires > 0 ? ` (${gameState.fires})` : '');
    d = d.replace('${netDesc}', gameState.hasNet ? ' FISHING NET! ' : '');
    print(d);
    print(`<div class="exits">üß≠ ${loc.exits.join(' | ')}</div>`);
    if (loc.actions.length) print(`‚ö° ${loc.actions.join(' | ')}`);
}

function go(dest) {
    dest = dest.toLowerCase();
    const valid = { camp: 'camp', beach: 'beach', forest: 'forest', cliff: 'cliff' };
    if (!valid[dest]) { print("<span class='danger'>Where?</span>"); return; }
    const loc = locations[gameState.currentLocation];
    if (!loc.exits.map(e => e.toLowerCase()).includes(valid[dest])) {
        print(`<span class='danger'>Can't go there</span>`); return;
    }
    gameState.currentLocation = valid[dest];
    lookRoom();
}

function showMap() {
    print(""); print("     CLIFF"); print("       |"); print("   FOREST--CAMP"); print("             |"); print("          BEACH");
}

function showStatus() {
    print(`‚è∞ ${gameState.hoursRemaining}/10 | üêü ${gameState.fish} | ü™µ ${gameState.wood} | üî• ${gameState.fires} | üõñ ${gameState.walls.toFixed(1)}/3`);
}

function doFish() {
    if (gameState.currentLocation !== 'beach') { print("<span class='danger'>Go to BEACH</span>"); return; }
    if (gameState.hoursRemaining < gameState.fishingRate) { print("<span class='danger'>Not enough time</span>"); return; }
    gameState.hoursRemaining -= gameState.fishingRate;
    gameState.fish += 1;
    print(`<span class='success'>‚úì Caught fish!</span> (${gameState.hoursRemaining} hrs left)`);
    gameState.dayActions.push({ action: 'fishing', result: 1 });
    updateDisplay();
    if (gameState.day === 4 && !gameState.hasNet) {
        print("");
        print("<span class='success'>‚ö° DISCOVERY! ‚ö°</span>");
        print("Tangled in debris - a professional fishing net!");
        print("Still intact. Industrial grade. Someone prepared for this.");
        print("<span class='warning'>Your fishing improved: 2hrs ‚Üí 1hr per fish</span>");
        print("<span class='action'>PPF shifts OUTWARD - this is ECONOMIC GROWTH!</span>");
        print("");
        gameState.hasNet = true;
        gameState.fishingRate = 1;
    }
}

function doGather() {
    if (gameState.currentLocation !== 'forest') { print("<span class='danger'>Go to FOREST</span>"); return; }
    if (gameState.hoursRemaining < gameState.gatheringRate) { print("<span class='danger'>Not enough time</span>"); return; }
    gameState.hoursRemaining -= gameState.gatheringRate;
    gameState.wood += 1;
    print(`<span class='success'>‚úì Gathered wood!</span> (${gameState.hoursRemaining} hrs left)`);
    gameState.dayActions.push({ action: 'gathering', result: 1 });
    updateDisplay();
}

function doBuild() {
    if (gameState.currentLocation !== 'camp') { print("<span class='danger'>Go to CAMP</span>"); return; }
    if (gameState.hoursRemaining < gameState.buildingRate) { print("<span class='danger'>Not enough time</span>"); return; }
    gameState.hoursRemaining -= gameState.buildingRate;
    gameState.walls += 1;
    print(`<span class='success'>‚úì Built wall!</span> ${gameState.walls.toFixed(1)}/3 (${gameState.hoursRemaining} hrs left)`);
    gameState.dayActions.push({ action: 'building', result: 1 });
    updateDisplay();
}

function doFire() {
    if (gameState.currentLocation !== 'camp') { print("<span class='danger'>Go to CAMP</span>"); return; }
    if (gameState.wood === 0) { print("<span class='danger'>Need wood!</span>"); return; }
    if (gameState.hoursRemaining < gameState.fireRate) { print("<span class='danger'>Not enough time</span>"); return; }
    gameState.hoursRemaining -= gameState.fireRate;
    gameState.wood -= 1;
    gameState.fires += 1;
    gameState.hadFireToday = true; // Track warmth for health
    print(`<span class='success'>‚úì Made fire! Warmth surrounds you.</span> (${gameState.hoursRemaining} hrs left)`);
    gameState.dayActions.push({ action: 'fire', result: 1 });
    updateDisplay();
}

function doEat() {
    if (gameState.fish === 0) { 
        print("<span class='danger'>No fish to eat! Catch some first.</span>"); 
        return; 
    }
    gameState.fish -= 1;
    gameState.fishEatenToday++;
    
    // Restore health
    const healthGain = 15;
    const oldHealth = gameState.health;
    gameState.health = Math.min(100, gameState.health + healthGain);
    const actualGain = gameState.health - oldHealth;
    
    // Flavor text based on fire availability
    if (gameState.fires > 0) {
        print(`<span class='success'>‚úì Cooked fish over the fire! +${Math.round(actualGain)}% health ‚Üí ${Math.round(gameState.health)}%</span>`);
        if (gameState.health < 70) {
            print("<span style='color:#ffcc00'>The warm meal helps. Still need more nutrition...</span>");
        } else {
            print("<span style='color:#00ff88'>Hot meal restores your energy. You feel stronger!</span>");
        }
    } else {
        print(`<span class='success'>‚úì Ate raw fish. +${Math.round(actualGain)}% health ‚Üí ${Math.round(gameState.health)}%</span>`);
        if (gameState.health < 70) {
            print("<span style='color:#ffcc00'>You grimace. Should cook this next time...</span>");
        } else {
            print("<span style='color:#00ff88'>Not ideal, but it works. Energy restored.</span>");
        }
    }
    updateDisplay();
}

function endDay() {
    if (gameState.hoursRemaining === 10) { print("<span class='danger'>Do something first!</span>"); return; }
    clearScreen();
    print(`<span class='warning' style='font-size:1.3rem;'>‚òÄÔ∏è DAY ${gameState.day} ENDS ‚òÄÔ∏è</span>`);
    print("");
    const used = 10 - gameState.hoursRemaining;
    print(`You used ${used}/10 hours`);
    if (gameState.hoursRemaining > 0) print(`<span class='danger'>Wasted ${gameState.hoursRemaining} hours!</span>`);
    
    // HEALTH SYSTEM - Daily penalties
    print(""); print("");
    print("<div style='border:2px solid #ff3366; padding:10px; background:#1a0a0a;'>");
    print("<span style='color:#ff3366; font-weight:bold;'>üè• HEALTH CHECK</span>");
    
    let healthChange = 0;
    
    // Food penalty/bonus
    if (gameState.fishEatenToday === 0) {
        healthChange -= 20;
        print("<span class='danger'>- No food eaten: -20% health</span>");
    } else if (gameState.fishEatenToday === 1) {
        print("<span style='color:#ffcc00'>‚ö† Barely ate (1 fish)</span>");
    } else {
        healthChange += 5;
        print(`<span class='success'>‚úì Well-fed (${gameState.fishEatenToday} fish): +5% health</span>`);
    }
    
    // Warmth penalty
    if (!gameState.hadFireToday) {
        healthChange -= 10;
        print("<span class='danger'>- No warmth: -10% health</span>");
    } else {
        print("<span class='success'>‚úì Had fire for warmth</span>");
    }
    
    // Apply health change
    const oldHealth = gameState.health;
    gameState.health = Math.max(0, Math.min(100, gameState.health + healthChange));
    
    print("");
    if (healthChange < 0) {
        print(`<span class='danger'>Health: ${Math.round(oldHealth)}% ‚Üí ${Math.round(gameState.health)}% (${healthChange}%)</span>`);
    } else if (healthChange > 0) {
        print(`<span class='success'>Health: ${Math.round(oldHealth)}% ‚Üí ${Math.round(gameState.health)}% (+${healthChange}%)</span>`);
    } else {
        print(`<span style='color:#ffcc00'>Health: ${Math.round(gameState.health)}% (no change)</span>`);
    }
    
    print("</div>");
    updateDisplay();
    
    // Check for death
    if (gameState.health <= 0) {
        print(""); print("");
        print("<span class='danger' style='font-size:1.5rem;'>üíÄ YOU DIED üíÄ</span>");
        print("");
        print("Your health reached zero. The island claimed another victim.");
        print("Economics lesson: SURVIVAL is a prerequisite for all production!");
        print("");
        print("<span class='action'>Refresh to try again</span>");
        gameState.phase = 'complete';
        return;
    }
    
    // Reset daily trackers for next day
    gameState.fishEatenToday = 0;
    gameState.hadFireToday = false;
    
    print(""); print("");
    print("<span class='action'>Press ENTER for evening lesson...</span>");
    gameState.phase = 'wait';
    gameState.nextPhase = 'lesson';
    document.getElementById('helpBox').innerHTML = 'Press ENTER';
}

function showLesson() {
    clearScreen();
    print("<div class='lesson-header'>üìö ECONOMICS LESSON</div>");
    print("");
    const fishProduced = gameState.dayActions.filter(a => a.action === 'fishing').length;
    const wallsProduced = gameState.dayActions.filter(a => a.action === 'building').length;
    print("<div class='lesson-content'>");
    print("PPF = PRODUCTION POSSIBILITIES FRONTIER");
    print("The LIMIT of what you can PRODUCE.");
    print("</div>");
    print("");
    drawPPFGraph(fishProduced, wallsProduced, gameState.hasNet && gameState.day === 4);
    print("");
    print("<div class='lesson-content'>");
    const used = 10 - gameState.hoursRemaining;
    if (used === 10) {
        print("<span class='success'>EFFICIENT!</span> You're ON the frontier.");
    } else {
        print("<span class='danger'>INEFFICIENT!</span> You're INSIDE the frontier.");
        print(`Wasted ${gameState.hoursRemaining} hours.`);
    }
    if (gameState.hasNet && gameState.day === 4) {
        print("");
        print("<span class='success'>‚ö° PPF shifted OUT! ECONOMIC GROWTH!</span>");
    }
    print("</div>");
    print(""); print("");
    print("<span class='action'>Press ENTER for quiz...</span>");
    gameState.phase = 'wait';
    gameState.nextPhase = 'quiz';
}

function showQuiz() {
    clearScreen();
    const q = quizQuestions[gameState.day - 1];
    print("<div class='lesson-header'>‚úì QUIZ - DAY " + gameState.day + "</div>");
    print("");
    print(q.question);
    print("");
    q.options.forEach(opt => print(opt));
    print("");
    print("Type your answer:");
    gameState.phase = 'quiz';
    gameState.currentLessonQuestion = q;
}

function checkAnswer(ans) {
    const q = gameState.currentLessonQuestion;
    gameState.quizAnswers.push({ day: gameState.day, answer: ans, correct: ans === q.correct });
    if (ans === q.correct) {
        print(""); print("<span class='success'>‚úì CORRECT!</span>");
        print(""); print(q.explanation);
        if (gameState.day === 5) {
            endGame();
        } else {
            print(""); print(""); print("<span class='action'>Press ENTER for next day...</span>");
            gameState.phase = 'wait';
            gameState.nextPhase = 'nextday';
        }
    } else {
        print(""); print("<span class='danger'>Try again.</span>");
    }
}

function endGame() {
    print(""); print("");
    print("<div class='lesson-header'>‚õàÔ∏è NIGHT 5 - THE STORM ‚õàÔ∏è</div>");
    print("");
    
    // Calculate survival score
    const survivalScore = gameState.walls + (gameState.fish/10) + (gameState.fires/5);
    const correctQuizzes = gameState.quizAnswers.filter(a => a.correct).length;
    
    // Storm narrative
    print("<span class='danger'>Wind howls. Rain hammers. Thunder cracks.</span>");
    print("You huddle in your shelter as the island rages.");
    print("");
    
    // Multiple endings based on walls built
    if (gameState.walls >= 3) {
        print("<span class='success' style='font-size:1.3rem;'>‚úì YOUR SHELTER HOLDS!</span>");
        print("");
        print(`Your ${gameState.walls.toFixed(1)} walls stand firm against the storm.`);
        print("Water leaks through gaps, but the structure is solid.");
        print("Hours pass. The storm subsides.");
        print("");
        print("<span class='warning'>DAWN - DAY 6</span>");
        print("");
        print("Chopper blades in the distance. Growing louder.");
        print("COAST GUARD emblazoned on the side. They found you!");
        print("");
        if (survivalScore >= 5) {
            print("<span class='success'>‚≠ê PERFECT SURVIVAL ‚≠ê</span>");
            print("Paramedic: 'Remarkable condition for 5 days alone.'");
            print("You hand them your journal - detailed economic analysis.");
            print("'Doctor Chen, you turned scarcity into success.'");
        } else {
            print("Paramedic: 'You made it. Tough five days.'");
            print("You're exhausted but alive. The rescue team lifts you out.");
        }
    } else {
        print("<span class='danger' style='font-size:1.3rem;'>‚ö†Ô∏è YOUR SHELTER COLLAPSES!</span>");
        print("");
        print(`Only ${gameState.walls.toFixed(1)} walls... not enough.`);
        print("The storm rips through your camp. You take cover under debris.");
        print("Cold. Wet. Terrified.");
        print("");
        print("<span class='warning'>DAWN - DAY 6</span>");
        print("");
        print("Chopper arrives. You're found alive, but hypothermic.");
        print("Paramedic: 'Close call. Another night might have been different.'");
        print("");
        print("<span class='danger'>You survived, but inefficiency cost you.</span>");
    }
    
    print("");
    print("<div class='lesson-content'>");
    print("<span class='success'>‚îÅ‚îÅ‚îÅ ECONOMIC CONCEPTS MASTERED ‚îÅ‚îÅ‚îÅ</span>");
    print("");
    print("  ‚úì SCARCITY - 10 hours/day forced choices");
    print("  ‚úì PPF - the boundary of possible production");  
    print("  ‚úì OPPORTUNITY COST - every choice had trade-offs");
    print("  ‚úì EFFICIENCY - points inside vs on the frontier");
    print("  ‚úì ECONOMIC GROWTH - fishing net shifted your PPF");
    print("");
    print(`<span class='warning'>Quiz Score: ${correctQuizzes}/5 correct</span>`);
    print(`<span class='action'>Survival Rating: ${survivalScore.toFixed(1)}/10</span>`);
    print("");
    if (correctQuizzes >= 4 && gameState.walls >= 3) {
        print("<span class='success'>‚≠ê MASTER ECONOMIST - You understand PPF perfectly! ‚≠ê</span>");
    } else if (correctQuizzes >= 3) {
        print("Good economic thinking! Review missed concepts.");
    } else {
        print("Keep studying! Economics is about making choices under scarcity.");
    }
    print("</div>");
    print("");
    print("<span class='action'>Debrief complete. Journal archived. Welcome home, Dr. Chen.</span>");
    
    gameState.phase = 'complete';
}

document.getElementById('commandInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        if (gameState.phase === 'wait' && gameState.nextPhase === 'nextday') {
            gameState.day++;
            gameState.hoursRemaining = 10;
            gameState.dayActions = [];
            gameState.phase = 'wait';
            gameState.nextPhase = 'playing';
            processCommand();
        } else {
            processCommand();
        }
    }
});

runVocabTutorial();
</script>
</body>
</html>
