<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supply & Demand Interactive Lab | ClassClick</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #333; }
        
        /* Header */
        .header { background: #2B2D42; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.5rem; }
        .header span { color: #14B8A6; }
        .progress-bar { display: flex; gap: 8px; align-items: center; }
        .progress-dot { width: 12px; height: 12px; border-radius: 50%; background: #555; transition: all 0.3s; }
        .progress-dot.complete { background: #14B8A6; }
        .progress-dot.active { background: #F59E0B; box-shadow: 0 0 8px #F59E0B; }
        .progress-label { font-size: 0.75rem; color: #aaa; margin-left: 5px; }
        
        /* Main container */
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        /* Section tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab { padding: 12px 24px; background: #2B2D42; color: #888; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-size: 1rem; transition: all 0.3s; }
        .tab:hover:not(:disabled) { background: #3B3D52; }
        .tab.active { background: white; color: #2B2D42; font-weight: bold; }
        .tab:disabled { cursor: not-allowed; opacity: 0.5; }
        .tab.locked::before { content: "üîí "; }
        .tab.unlocked::before { content: ""; }
        
        /* Content panels */
        .panel { display: none; background: white; border-radius: 0 12px 12px 12px; padding: 30px; min-height: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .panel.active { display: block; }
        
        /* LEARN MODE */
        .lesson-container { display: flex; gap: 30px; }
        .lesson-content { flex: 1; }
        .lesson-visual { flex: 1; display: flex; justify-content: center; align-items: center; }
        .lesson-title { font-size: 1.8rem; color: #2B2D42; margin-bottom: 15px; }
        .lesson-text { font-size: 1.1rem; line-height: 1.7; color: #444; margin-bottom: 20px; }
        .highlight { background: linear-gradient(120deg, #FEF3C7 0%, #FEF3C7 100%); padding: 2px 6px; border-radius: 4px; }
        .term { font-weight: bold; color: #14B8A6; }
        
        /* Lesson navigation */
        .lesson-nav { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .lesson-progress { color: #888; font-size: 0.9rem; }
        .btn { padding: 12px 28px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #14B8A6; color: white; }
        .btn-primary:hover { background: #0D9488; transform: translateY(-2px); }
        .btn-secondary { background: #eee; color: #666; }
        .btn-secondary:hover { background: #ddd; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        /* Interactive elements in lessons */
        .interactive-prompt { background: #F0FDF4; border-left: 4px solid #14B8A6; padding: 15px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        .interactive-prompt strong { color: #14B8A6; }
        
        /* Canvas for graphs */
        canvas { border-radius: 8px; background: #FAFAFA; }
        
        /* Buttons row */
        .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0; }
        .btn-small { padding: 8px 16px; font-size: 0.9rem; border-radius: 6px; border: 2px solid #ddd; background: white; cursor: pointer; transition: all 0.2s; }
        .btn-small:hover { border-color: #14B8A6; background: #F0FDF4; }
        .btn-small.active { border-color: #14B8A6; background: #14B8A6; color: white; }
        
        /* Quiz styles */
        .quiz-question { background: #F8F8F8; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        .quiz-question h3 { color: #2B2D42; margin-bottom: 15px; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-option { padding: 15px 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .quiz-option:hover { border-color: #14B8A6; background: #F0FDF4; }
        .quiz-option.selected { border-color: #14B8A6; background: #D1FAE5; }
        .quiz-option.correct { border-color: #10B981; background: #D1FAE5; }
        .quiz-option.incorrect { border-color: #EF4444; background: #FEE2E2; }
        
        /* Score screen */
        .score-screen { text-align: center; padding: 40px; }
        .score-big { font-size: 5rem; font-weight: bold; color: #14B8A6; }
        .score-label { font-size: 1.5rem; color: #666; margin-bottom: 30px; }
        .score-details { background: #F8F8F8; padding: 20px; border-radius: 12px; margin: 20px auto; max-width: 400px; }
        .print-section { margin-top: 30px; padding: 20px; border: 2px dashed #ccc; border-radius: 12px; }
        .print-section input { padding: 10px; font-size: 1rem; border: 1px solid #ddd; border-radius: 6px; margin: 5px; width: 200px; }
        
        /* Market Mogul styles */
        .sim-header { display: flex; justify-content: space-between; background: #2B2D42; color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; }
        .sim-stat { text-align: center; }
        .sim-stat-value { font-size: 1.5rem; font-weight: bold; color: #14B8A6; }
        .sim-stat-label { font-size: 0.8rem; color: #aaa; }
        .news-ticker { background: #FEF3C7; border-left: 4px solid #F59E0B; padding: 12px 16px; border-radius: 0 8px 8px 0; margin-bottom: 20px; }
        .market-graph { background: #F8F8F8; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .price-slider { width: 100%; margin: 20px 0; }
        .results-panel { background: #F0FDF4; padding: 20px; border-radius: 12px; }
        
        /* Feedback messages */
        .feedback { padding: 15px 20px; border-radius: 8px; margin: 15px 0; font-weight: 500; }
        .feedback.correct { background: #D1FAE5; color: #065F46; }
        .feedback.incorrect { background: #FEE2E2; color: #991B1B; }
        .feedback.info { background: #E0F2FE; color: #0C4A6E; }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.85rem; margin-top: 30px; }
        
        /* Animations */
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: slideIn 0.4s ease-out; }
        
        /* Graph area label styles */
        .zone-label { font-size: 0.9rem; padding: 4px 8px; border-radius: 4px; }
        
        /* MOBILE RESPONSIVE STYLES */
        @media (max-width: 768px) {
            /* Header adjustments */
            .header { 
                flex-direction: column; 
                gap: 15px; 
                padding: 15px; 
                text-align: center; 
            }
            .header h1 { font-size: 1.2rem; }
            .progress-bar { 
                justify-content: center; 
                flex-wrap: wrap; 
                gap: 5px; 
            }
            .progress-label { font-size: 0.7rem; }
            
            /* Container */
            .container { padding: 10px; }
            
            /* Tabs - make them scrollable */
            .tabs { 
                overflow-x: auto; 
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            .tabs::-webkit-scrollbar { display: none; }
            .tab { 
                padding: 10px 16px; 
                font-size: 0.9rem; 
                white-space: nowrap; 
                min-width: 100px;
                flex-shrink: 0;
            }
            
            /* Panels */
            .panel { 
                padding: 15px; 
                min-height: auto; 
                border-radius: 8px; 
            }
            
            /* Lesson layout - stack vertically */
            .lesson-container { 
                flex-direction: column; 
                gap: 20px; 
            }
            .lesson-content { order: 1; }
            .lesson-visual { 
                order: 2; 
                width: 100%;
                max-width: 100%;
            }
            
            /* Text sizes */
            .lesson-title { font-size: 1.4rem; }
            .lesson-text { font-size: 1rem; line-height: 1.6; }
            .interactive-prompt { 
                font-size: 0.9rem; 
                padding: 12px 15px; 
            }
            
            /* Canvas - make responsive */
            canvas { 
                max-width: 100% !important; 
                height: auto !important; 
                touch-action: none;
                width: 100% !important;
            }
            
            /* Buttons - make touch-friendly (44px min) */
            .btn { 
                padding: 14px 24px; 
                font-size: 1rem; 
                min-height: 44px;
                width: 100%;
                max-width: 300px;
            }
            .btn-small { 
                padding: 10px 14px; 
                min-height: 44px; 
                font-size: 0.9rem;
                flex: 1;
                min-width: 100px;
            }
            .btn-row { 
                justify-content: center;
                gap: 8px;
            }
            
            /* Lesson navigation */
            .lesson-nav { 
                flex-direction: column; 
                gap: 12px; 
                align-items: stretch;
            }
            .lesson-nav .btn { 
                width: 100%;
                max-width: none;
            }
            .lesson-progress { 
                order: -1; 
                margin-bottom: 10px;
                text-align: center;
            }
            
            /* Quiz */
            .quiz-question { padding: 15px; }
            .quiz-option { 
                padding: 14px 16px; 
                font-size: 0.95rem; 
                min-height: 44px;
            }
            
            /* Score screen */
            .score-big { font-size: 3.5rem; }
            .score-label { font-size: 1.2rem; }
            .score-details { 
                padding: 15px;
                margin: 15px 10px;
            }
            .print-section { 
                padding: 15px;
                margin: 20px 0;
            }
            .print-section input { 
                width: 100%; 
                max-width: 250px;
                margin: 5px 0;
            }
            
            /* Market Mogul */
            .sim-header { 
                flex-wrap: wrap; 
                padding: 12px;
                gap: 10px;
            }
            .sim-stat { 
                flex: 1 1 45%; 
                margin: 5px;
                min-width: 120px;
            }
            .sim-stat-value { font-size: 1.3rem; }
            .news-ticker { font-size: 0.9rem; padding: 10px 12px; }
            .market-graph { padding: 15px; }
            .price-slider { margin: 15px 0; }
            
            /* Footer */
            .footer { font-size: 0.8rem; padding: 15px 10px; }
        }
        
        @media (max-width: 480px) {
            /* Extra small screens */
            .header h1 { font-size: 1rem; }
            .tab { 
                padding: 8px 12px; 
                font-size: 0.85rem; 
                min-width: 85px; 
            }
            .lesson-title { font-size: 1.3rem; }
            .lesson-text { font-size: 0.95rem; }
            .btn { 
                padding: 12px 20px; 
                font-size: 0.95rem; 
            }
            .btn-small { 
                padding: 10px 12px;
                font-size: 0.85rem;
            }
            .score-big { font-size: 2.8rem; }
            .score-label { font-size: 1rem; }
            .sim-stat { 
                flex: 1 1 100%;
                margin: 3px 0;
            }
            .sim-stat-value { font-size: 1.2rem; }
            .quiz-option { font-size: 0.9rem; padding: 12px; }
        }
        
        /* Touch device improvements */
        @media (hover: none) and (pointer: coarse) {
            /* Increase all touch targets to 44px minimum */
            .tab, .btn, .quiz-option, .btn-small { min-height: 44px; }
            
            /* Remove hover effects on touch devices */
            .tab:hover:not(:disabled),
            .btn-secondary:hover, 
            .btn-small:hover, 
            .quiz-option:hover { 
                transform: none;
                background: inherit;
                border-color: inherit;
            }
            .btn-primary:hover { 
                transform: none; 
                background: #14B8A6;
            }
            
            /* Add active states for touch feedback */
            .tab:active:not(:disabled) { background: #3B3D52; }
            .btn-primary:active { background: #0D9488; }
            .btn-small:active { border-color: #14B8A6; background: #F0FDF4; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>ClassClick</span> | Supply & Demand Lab</h1>
        <div class="progress-bar">
            <div class="progress-dot active" id="dot-learn"></div>
            <span class="progress-label">Learn</span>
            <div class="progress-dot" id="dot-practice"></div>
            <span class="progress-label">Practice</span>
            <div class="progress-dot" id="dot-simulate"></div>
            <span class="progress-label">Simulate</span>
            <div class="progress-dot" id="dot-quiz"></div>
            <span class="progress-label">Quiz</span>
        </div>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" id="tab-learn" onclick="showSection('learn')">üìö Learn</button>
            <button class="tab locked" id="tab-practice" onclick="showSection('practice')" disabled>üéØ Practice</button>
            <button class="tab locked" id="tab-simulate" onclick="showSection('simulate')" disabled>üè™ Market Mogul</button>
            <button class="tab locked" id="tab-quiz" onclick="showSection('quiz')" disabled>üìù Quiz</button>
        </div>
        
        <!-- LEARN SECTION -->
        <div class="panel active" id="panel-learn">
            <div id="lesson-container"></div>
        </div>
        
        <!-- PRACTICE SECTION -->
        <div class="panel" id="panel-practice">
            <div id="practice-container"></div>
        </div>
        
        <!-- SIMULATE SECTION -->
        <div class="panel" id="panel-simulate">
            <div id="simulate-container"></div>
        </div>
        
        <!-- QUIZ SECTION -->
        <div class="panel" id="panel-quiz">
            <div id="quiz-container"></div>
        </div>
    </div>
    
    <div class="footer">
        ClassClick by Robert Jones<br>
        ¬© 2026 All rights reserved. | <span style="color:#bbb;font-size:10px;">SKELKEYTEC</span><br>
        Best on Chromebook, laptop, or desktop
    </div>

<script>
// ==================== STATE ====================
const state = {
    currentLesson: 0,
    learnComplete: false,
    practiceComplete: false,
    simulateComplete: false,
    quizComplete: false,
    quizScore: 0,
    quizAnswers: [],
    quizLocked: false,
    
    // Practice mode
    practiceMode: 'explore', // explore, challenge
    challengeRound: 0,
    challengeScore: 0,
    
    // Simulation
    simWeek: 1,
    simCash: 1000,
    simInventory: 50,
    simReputation: 50,
    simPrice: 100,
    simHistory: []
};

// ==================== LESSONS ====================
const lessons = [
    {
        title: "Welcome to the Sneaker Market!",
        content: `<p class="lesson-text">You're about to learn one of the most powerful ideas in economics: <span class="term">Supply and Demand</span>.</p>
        <p class="lesson-text">These two forces determine the price of almost everything ‚Äî from sneakers to concert tickets to gas.</p>
        <p class="lesson-text">By the end of this lab, you'll be able to predict how prices change when the market shifts.</p>
        <div class="interactive-prompt"><strong>üéØ Your Goal:</strong> Master supply and demand so you can run your own sneaker business in the simulation!</div>`,
        visual: 'intro',
        interactive: false
    },
    {
        title: "What is Demand?",
        content: `<p class="lesson-text"><span class="term">Demand</span> is how much of a product <span class="highlight">buyers want to purchase</span> at different prices.</p>
        <p class="lesson-text">Here's the key insight: <strong>When the price goes DOWN, people want to buy MORE.</strong></p>
        <p class="lesson-text">Think about it: If those $200 sneakers dropped to $50, wouldn't you be more likely to buy them?</p>
        <div class="interactive-prompt"><strong>üëÜ Try it:</strong> Click different prices on the graph to see how quantity demanded changes.</div>`,
        visual: 'demand',
        interactive: true
    },
    {
        title: "The Demand Curve",
        content: `<p class="lesson-text">When we plot all those price/quantity combinations, we get the <span class="term">Demand Curve</span>.</p>
        <p class="lesson-text">Notice it slopes <span class="highlight">downward</span> from left to right. This is the <strong>Law of Demand</strong>:</p>
        <p class="lesson-text" style="font-size: 1.3rem; text-align: center; padding: 15px; background: #F0FDF4; border-radius: 8px;">‚¨áÔ∏è Price goes DOWN ‚Üí Quantity Demanded goes UP ‚¨ÜÔ∏è</p>
        <div class="interactive-prompt"><strong>üß† Remember:</strong> Demand curves slope DOWN like going DOWN a slide.</div>`,
        visual: 'demand-curve',
        interactive: false
    },
    {
        title: "What is Supply?",
        content: `<p class="lesson-text"><span class="term">Supply</span> is how much of a product <span class="highlight">sellers want to sell</span> at different prices.</p>
        <p class="lesson-text">Here's the key insight: <strong>When the price goes UP, sellers want to sell MORE.</strong></p>
        <p class="lesson-text">Makes sense, right? If you're selling sneakers, you'd rather sell them for $200 than $50!</p>
        <div class="interactive-prompt"><strong>üëÜ Try it:</strong> Click different prices to see how quantity supplied changes.</div>`,
        visual: 'supply',
        interactive: true
    },
    {
        title: "The Supply Curve",
        content: `<p class="lesson-text">When we plot all those price/quantity combinations, we get the <span class="term">Supply Curve</span>.</p>
        <p class="lesson-text">Notice it slopes <span class="highlight">upward</span> from left to right. This is the <strong>Law of Supply</strong>:</p>
        <p class="lesson-text" style="font-size: 1.3rem; text-align: center; padding: 15px; background: #FEF3C7; border-radius: 8px;">‚¨ÜÔ∏è Price goes UP ‚Üí Quantity Supplied goes UP ‚¨ÜÔ∏è</p>
        <div class="interactive-prompt"><strong>üß† Remember:</strong> Supply curves slope UP like climbing UP a hill.</div>`,
        visual: 'supply-curve',
        interactive: false
    },
    {
        title: "Equilibrium: Where They Meet",
        content: `<p class="lesson-text">Now let's put supply and demand together!</p>
        <p class="lesson-text">The point where the curves cross is called <span class="term">Equilibrium</span> ‚Äî the "sweet spot" where:</p>
        <p class="lesson-text">‚Ä¢ Buyers want to buy exactly as much as sellers want to sell<br>‚Ä¢ There's no shortage and no surplus<br>‚Ä¢ The market "clears"</p>
        <div class="interactive-prompt"><strong>‚öñÔ∏è Equilibrium</strong> gives us two things: the <strong>equilibrium price</strong> and the <strong>equilibrium quantity</strong>.</div>`,
        visual: 'equilibrium',
        interactive: true
    },
    {
        title: "What's a Shortage?",
        content: `<p class="lesson-text">A <span class="term">Shortage</span> happens when the price is <span class="highlight">below equilibrium</span>.</p>
        <p class="lesson-text">At low prices:<br>‚Ä¢ Buyers want MORE (great deal!)<br>‚Ä¢ Sellers supply LESS (not worth it)<br>‚Ä¢ <strong>Demand > Supply = Shortage</strong></p>
        <p class="lesson-text">Think: New sneaker drops where everyone wants them but stores sell out instantly.</p>
        <div class="interactive-prompt"><strong>üëÜ Try it:</strong> Drag the price line below equilibrium to see the shortage appear.</div>`,
        visual: 'shortage',
        interactive: true
    },
    {
        title: "What's a Surplus?",
        content: `<p class="lesson-text">A <span class="term">Surplus</span> happens when the price is <span class="highlight">above equilibrium</span>.</p>
        <p class="lesson-text">At high prices:<br>‚Ä¢ Buyers want LESS (too expensive!)<br>‚Ä¢ Sellers supply MORE (big profits!)<br>‚Ä¢ <strong>Supply > Demand = Surplus</strong></p>
        <p class="lesson-text">Think: Shelves full of sneakers that nobody's buying because they're overpriced.</p>
        <div class="interactive-prompt"><strong>üëÜ Try it:</strong> Drag the price line above equilibrium to see the surplus appear.</div>`,
        visual: 'surplus',
        interactive: true
    },
    {
        title: "Demand Shifters",
        content: `<p class="lesson-text">Sometimes the <strong>entire demand curve shifts</strong> left or right. This changes equilibrium!</p>
        <p class="lesson-text"><span class="term">Demand increases</span> (shifts RIGHT) when:</p>
        <p class="lesson-text">‚Ä¢ More buyers enter the market<br>‚Ä¢ Buyers' income increases<br>‚Ä¢ The product becomes trendy<br>‚Ä¢ Price of substitutes goes up</p>
        <p class="lesson-text"><span class="term">Demand decreases</span> (shifts LEFT) when the opposite happens.</p>
        <div class="interactive-prompt"><strong>üëÜ Try it:</strong> Click the buttons to shift demand and watch equilibrium change.</div>`,
        visual: 'demand-shift',
        interactive: true
    },
    {
        title: "Supply Shifters",
        content: `<p class="lesson-text">The <strong>supply curve can also shift</strong> left or right!</p>
        <p class="lesson-text"><span class="term">Supply increases</span> (shifts RIGHT) when:</p>
        <p class="lesson-text">‚Ä¢ Production costs decrease<br>‚Ä¢ New technology improves efficiency<br>‚Ä¢ More sellers enter the market<br>‚Ä¢ Good weather (for agriculture)</p>
        <p class="lesson-text"><span class="term">Supply decreases</span> (shifts LEFT) when the opposite happens.</p>
        <div class="interactive-prompt"><strong>üëÜ Try it:</strong> Click the buttons to shift supply and watch equilibrium change.</div>`,
        visual: 'supply-shift',
        interactive: true
    },
    {
        title: "You're Ready!",
        content: `<p class="lesson-text">üéâ <strong>Awesome!</strong> You've learned the fundamentals of supply and demand!</p>
        <p class="lesson-text"><strong>Quick Review:</strong></p>
        <p class="lesson-text">‚Ä¢ <span class="term">Demand</span> slopes DOWN ‚Äî lower price = more buyers<br>‚Ä¢ <span class="term">Supply</span> slopes UP ‚Äî higher price = more sellers<br>‚Ä¢ <span class="term">Equilibrium</span> ‚Äî where curves meet<br>‚Ä¢ <span class="term">Shortage</span> ‚Äî price too low<br>‚Ä¢ <span class="term">Surplus</span> ‚Äî price too high<br>‚Ä¢ Curves can <span class="term">shift</span> when market conditions change</p>
        <div class="interactive-prompt"><strong>üöÄ Next Up:</strong> Practice mode ‚Äî test your skills reading supply and demand graphs!</div>`,
        visual: 'summary',
        interactive: false
    }
];

// ==================== LESSON RENDERING ====================
function renderLesson() {
    const lesson = lessons[state.currentLesson];
    const container = document.getElementById('lesson-container');
    
    container.innerHTML = `
        <div class="lesson-container animate-in">
            <div class="lesson-content">
                <h2 class="lesson-title">${lesson.title}</h2>
                ${lesson.content}
            </div>
            <div class="lesson-visual">
                <canvas id="lesson-canvas" width="400" height="350"></canvas>
            </div>
        </div>
        <div class="lesson-nav">
            <button class="btn btn-secondary" onclick="prevLesson()" ${state.currentLesson === 0 ? 'disabled' : ''}>‚Üê Back</button>
            <span class="lesson-progress">Lesson ${state.currentLesson + 1} of ${lessons.length}</span>
            <button class="btn btn-primary" onclick="nextLesson()">${state.currentLesson === lessons.length - 1 ? 'Start Practice ‚Üí' : 'Next ‚Üí'}</button>
        </div>
    `;
    
    drawLessonVisual(lesson.visual);
    if (lesson.interactive) setupLessonInteraction(lesson.visual);
}

function drawLessonVisual(type) {
    const canvas = document.getElementById('lesson-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 400, 350);
    
    const margin = { left: 50, right: 30, top: 30, bottom: 50 };
    const w = 400 - margin.left - margin.right;
    const h = 350 - margin.top - margin.bottom;
    
    // Draw axes
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(margin.left, margin.top);
    ctx.lineTo(margin.left, margin.top + h);
    ctx.lineTo(margin.left + w, margin.top + h);
    ctx.stroke();
    
    // Labels
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Quantity', margin.left + w/2, 340);
    ctx.save();
    ctx.translate(15, margin.top + h/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Price ($)', 0, 0);
    ctx.restore();
    
    // Draw based on type
    if (type === 'intro' || type === 'summary') {
        drawBothCurves(ctx, margin, w, h, 0, 0);
        drawEquilibriumPoint(ctx, margin, w, h, 0, 0);
    } else if (type === 'demand' || type === 'demand-curve') {
        drawDemandCurve(ctx, margin, w, h, 0);
    } else if (type === 'supply' || type === 'supply-curve') {
        drawSupplyCurve(ctx, margin, w, h, 0);
    } else if (type === 'equilibrium') {
        drawBothCurves(ctx, margin, w, h, 0, 0);
        drawEquilibriumPoint(ctx, margin, w, h, 0, 0);
    } else if (type === 'shortage') {
        drawBothCurves(ctx, margin, w, h, 0, 0);
        drawPriceLine(ctx, margin, w, h, 0.35, 'shortage');
    } else if (type === 'surplus') {
        drawBothCurves(ctx, margin, w, h, 0, 0);
        drawPriceLine(ctx, margin, w, h, 0.65, 'surplus');
    } else if (type === 'demand-shift') {
        drawBothCurves(ctx, margin, w, h, state.demandShift || 0, 0);
        drawEquilibriumPoint(ctx, margin, w, h, state.demandShift || 0, 0);
    } else if (type === 'supply-shift') {
        drawBothCurves(ctx, margin, w, h, 0, state.supplyShift || 0);
        drawEquilibriumPoint(ctx, margin, w, h, 0, state.supplyShift || 0);
    }
}

function drawDemandCurve(ctx, margin, w, h, shift) {
    ctx.strokeStyle = '#E8505B';
    ctx.lineWidth = 3;
    ctx.beginPath();
    for (let i = 0; i <= 100; i++) {
        const x = margin.left + (i/100) * w + shift * 50;
        const y = margin.top + (i/100) * h;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    }
    ctx.stroke();
    
    // Label
    ctx.fillStyle = '#E8505B';
    ctx.font = 'bold 14px Arial';
    ctx.fillText('D', margin.left + w - 20 + shift * 50, margin.top + h - 20);
}

function drawSupplyCurve(ctx, margin, w, h, shift) {
    ctx.strokeStyle = '#14B8A6';
    ctx.lineWidth = 3;
    ctx.beginPath();
    for (let i = 0; i <= 100; i++) {
        const x = margin.left + (i/100) * w - shift * 50;
        const y = margin.top + h - (i/100) * h;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    }
    ctx.stroke();
    
    // Label
    ctx.fillStyle = '#14B8A6';
    ctx.font = 'bold 14px Arial';
    ctx.fillText('S', margin.left + w - 20 - shift * 50, margin.top + 30);
}

function drawBothCurves(ctx, margin, w, h, demandShift, supplyShift) {
    drawDemandCurve(ctx, margin, w, h, demandShift);
    drawSupplyCurve(ctx, margin, w, h, supplyShift);
}

function drawEquilibriumPoint(ctx, margin, w, h, demandShift, supplyShift) {
    // Calculate equilibrium (where lines cross)
    const eqX = margin.left + w/2 + (demandShift - supplyShift) * 25;
    const eqY = margin.top + h/2 + (supplyShift - demandShift) * 25;
    
    // Dotted lines
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 1;
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.moveTo(eqX, eqY);
    ctx.lineTo(eqX, margin.top + h);
    ctx.moveTo(eqX, eqY);
    ctx.lineTo(margin.left, eqY);
    ctx.stroke();
    ctx.setLineDash([]);
    
    // Point
    ctx.fillStyle = '#F59E0B';
    ctx.beginPath();
    ctx.arc(eqX, eqY, 8, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#333';
    ctx.font = 'bold 12px Arial';
    ctx.fillText('E', eqX + 15, eqY - 10);
}

function drawPriceLine(ctx, margin, w, h, priceLevel, type) {
    const y = margin.top + h - priceLevel * h;
    
    // Price line
    ctx.strokeStyle = '#F59E0B';
    ctx.lineWidth = 2;
    ctx.setLineDash([10, 5]);
    ctx.beginPath();
    ctx.moveTo(margin.left, y);
    ctx.lineTo(margin.left + w, y);
    ctx.stroke();
    ctx.setLineDash([]);
    
    // Find intersections
    const demandQ = priceLevel * w;
    const supplyQ = (1 - priceLevel) * w;
    
    // Highlight gap
    if (type === 'shortage') {
        ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
        ctx.fillRect(margin.left + supplyQ, y - 20, demandQ - supplyQ, 40);
        ctx.fillStyle = '#EF4444';
        ctx.font = 'bold 12px Arial';
        ctx.fillText('SHORTAGE', margin.left + (demandQ + supplyQ)/2, y + 5);
    } else {
        ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
        ctx.fillRect(margin.left + demandQ, y - 20, supplyQ - demandQ, 40);
        ctx.fillStyle = '#3B82F6';
        ctx.font = 'bold 12px Arial';
        ctx.fillText('SURPLUS', margin.left + (demandQ + supplyQ)/2, y + 5);
    }
}

function setupLessonInteraction(type) {
    const canvas = document.getElementById('lesson-canvas');
    if (!canvas) return;
    
    // Helper function to get coordinates from both mouse and touch events
    function getEventCoords(e) {
        const rect = canvas.getBoundingClientRect();
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { y: clientY - rect.top };
    }
    
    if (type === 'demand' || type === 'supply') {
        // Add click/touch handler for price points
        canvas.style.cursor = 'pointer';
        
        const handleInteraction = function(e) {
            e.preventDefault();
            const coords = getEventCoords(e);
            const margin = { top: 30, bottom: 50 };
            const h = 350 - margin.top - margin.bottom;
            const pricePercent = (coords.y - margin.top) / h;
            
            if (pricePercent >= 0 && pricePercent <= 1) {
                // Highlight the clicked price point
                drawLessonVisual(type);
                const ctx = canvas.getContext('2d');
                
                // Draw highlight at clicked price
                ctx.fillStyle = 'rgba(244, 114, 182, 0.3)';
                ctx.fillRect(0, coords.y - 5, canvas.width, 10);
                
                // Show price indicator
                ctx.fillStyle = '#2B2D42';
                ctx.font = 'bold 16px Arial';
                ctx.fillText(`Price: $${Math.round((1-pricePercent) * 100)}`, 250, coords.y + 5);
            }
        };
        
        canvas.onclick = handleInteraction;
        canvas.ontouchstart = handleInteraction;
    } else if (type === 'equilibrium') {
        // Make equilibrium point more visible
        canvas.style.cursor = 'default';
        const ctx = canvas.getContext('2d');
        const margin = { left: 50, right: 30, top: 30, bottom: 50 };
        const w = 400 - margin.left - margin.right;
        const h = 350 - margin.top - margin.bottom;
        
        // Draw pulsing effect on equilibrium
        let pulse = 0;
        const pulseInterval = setInterval(() => {
            drawLessonVisual('equilibrium');
            const eqX = margin.left + w * 0.5;
            const eqY = margin.top + h * 0.5;
            
            ctx.strokeStyle = `rgba(244, 114, 182, ${0.5 + Math.sin(pulse) * 0.3})`;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(eqX, eqY, 15 + Math.sin(pulse) * 5, 0, Math.PI * 2);
            ctx.stroke();
            
            pulse += 0.1;
            if (pulse > Math.PI * 4) clearInterval(pulseInterval);
        }, 50);
    } else if (type === 'shortage' || type === 'surplus') {
        // Add drag handler for price line - support both mouse and touch
        canvas.style.cursor = 'ns-resize';
        let isDragging = false;
        
        const startDrag = function() { isDragging = true; };
        const endDrag = function() { isDragging = false; };
        
        const handleDrag = function(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const coords = getEventCoords(e);
            const margin = { top: 30, bottom: 50, left: 50 };
            const h = 350 - margin.top - margin.bottom;
            let pricePercent = (coords.y - margin.top) / h;
            
            // Clamp between 0 and 1
            pricePercent = Math.max(0, Math.min(1, pricePercent));
            
            // Redraw with new price line
            const ctx = canvas.getContext('2d');
            drawLessonVisual(type);
            const w = 400 - margin.left - 50;
            
            ctx.strokeStyle = '#F59E0B';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top + h * pricePercent);
            ctx.lineTo(margin.left + w, margin.top + h * pricePercent);
            ctx.stroke();
            ctx.setLineDash([]);
        };
        
        // Mouse events
        canvas.onmousedown = startDrag;
        canvas.onmouseup = endDrag;
        canvas.onmouseleave = endDrag;
        canvas.onmousemove = handleDrag;
        
        // Touch events
        canvas.ontouchstart = function(e) {
            e.preventDefault();
            startDrag();
        };
        canvas.ontouchend = endDrag;
        canvas.ontouchmove = handleDrag;
    } else if (type === 'demand-shift') {
        const container = document.querySelector('.lesson-content');
        const btnRow = document.createElement('div');
        btnRow.className = 'btn-row';
        btnRow.innerHTML = `
            <button class="btn-small" onclick="shiftDemand(-1)">‚¨ÖÔ∏è Decrease Demand</button>
            <button class="btn-small" onclick="shiftDemand(0)">Reset</button>
            <button class="btn-small" onclick="shiftDemand(1)">Increase Demand ‚û°Ô∏è</button>
        `;
        container.appendChild(btnRow);
    } else if (type === 'supply-shift') {
        const container = document.querySelector('.lesson-content');
        const btnRow = document.createElement('div');
        btnRow.className = 'btn-row';
        btnRow.innerHTML = `
            <button class="btn-small" onclick="shiftSupply(-1)">‚¨ÖÔ∏è Decrease Supply</button>
            <button class="btn-small" onclick="shiftSupply(0)">Reset</button>
            <button class="btn-small" onclick="shiftSupply(1)">Increase Supply ‚û°Ô∏è</button>
        `;
        container.appendChild(btnRow);
    }
}

function shiftDemand(dir) {
    state.demandShift = dir === 0 ? 0 : dir;
    drawLessonVisual('demand-shift');
}

function shiftSupply(dir) {
    state.supplyShift = dir === 0 ? 0 : dir;
    drawLessonVisual('supply-shift');
}

function nextLesson() {
    if (state.currentLesson < lessons.length - 1) {
        state.currentLesson++;
        renderLesson();
    } else {
        // Complete learn, unlock practice
        state.learnComplete = true;
        unlockSection('practice');
        showSection('practice');
    }
}

function prevLesson() {
    if (state.currentLesson > 0) {
        state.currentLesson--;
        renderLesson();
    }
}

// ==================== SECTION MANAGEMENT ====================
function showSection(section) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    document.getElementById('panel-' + section).classList.add('active');
    document.getElementById('tab-' + section).classList.add('active');
    
    if (section === 'practice' && !document.getElementById('practice-container').innerHTML) {
        initPractice();
    } else if (section === 'simulate' && !document.getElementById('simulate-container').innerHTML) {
        initSimulate();
    } else if (section === 'quiz' && !document.getElementById('quiz-container').innerHTML) {
        initQuiz();
    }
    
    updateProgress();
}

function unlockSection(section) {
    const tab = document.getElementById('tab-' + section);
    tab.disabled = false;
    tab.classList.remove('locked');
}

function updateProgress() {
    document.getElementById('dot-learn').classList.toggle('complete', state.learnComplete);
    document.getElementById('dot-practice').classList.toggle('complete', state.practiceComplete);
    document.getElementById('dot-simulate').classList.toggle('complete', state.simulateComplete);
    document.getElementById('dot-quiz').classList.toggle('complete', state.quizComplete);
}

// ==================== PRACTICE MODE ====================
function initPractice() {
    const container = document.getElementById('practice-container');
    container.innerHTML = `
        <div class="animate-in">
            <h2 style="color: #2B2D42; margin-bottom: 10px;">üéØ Practice Mode</h2>
            <p style="color: #666; margin-bottom: 20px;">Master reading supply and demand graphs!</p>
            
            <div class="tabs" style="margin-bottom: 20px;">
                <button class="btn-small active" id="practice-explore-btn" onclick="showPracticeMode('explore')">üìä Explore</button>
                <button class="btn-small" id="practice-challenge-btn" onclick="showPracticeMode('challenge')">üèÜ Market Madness</button>
            </div>
            
            <div id="practice-content"></div>
        </div>
    `;
    showPracticeMode('explore');
}

function showPracticeMode(mode) {
    state.practiceMode = mode;
    document.querySelectorAll('#practice-container .btn-small').forEach(b => b.classList.remove('active'));
    document.getElementById('practice-' + mode + '-btn').classList.add('active');
    
    if (mode === 'explore') {
        renderExploreMode();
    } else {
        renderChallengeMode();
    }
}

function renderExploreMode() {
    const container = document.getElementById('practice-content');
    container.innerHTML = `
        <div style="display: flex; gap: 30px;">
            <div style="flex: 1;">
                <canvas id="explore-canvas" width="450" height="400"></canvas>
            </div>
            <div style="flex: 1;">
                <h3 style="color: #2B2D42; margin-bottom: 15px;">Adjust the Market</h3>
                
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: bold; color: #E8505B;">Demand Shift:</label>
                    <input type="range" id="demand-slider" min="-2" max="2" value="0" style="width: 100%;" oninput="updateExplore()">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #888;">
                        <span>‚Üê Decrease</span><span>Increase ‚Üí</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: bold; color: #14B8A6;">Supply Shift:</label>
                    <input type="range" id="supply-slider" min="-2" max="2" value="0" style="width: 100%;" oninput="updateExplore()">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #888;">
                        <span>‚Üê Decrease</span><span>Increase ‚Üí</span>
                    </div>
                </div>
                
                <div id="explore-info" style="background: #F8F8F8; padding: 20px; border-radius: 12px;">
                    <p><strong>Equilibrium Price:</strong> <span id="eq-price">$100</span></p>
                    <p><strong>Equilibrium Quantity:</strong> <span id="eq-qty">50 pairs</span></p>
                    <p id="market-status" style="margin-top: 10px; padding: 10px; border-radius: 8px; background: #D1FAE5; color: #065F46;"><strong>Market Status:</strong> Balanced ‚öñÔ∏è</p>
                </div>
                
                <button class="btn btn-secondary" style="margin-top: 15px;" onclick="resetExplore()">Reset</button>
            </div>
        </div>
    `;
    updateExplore();
}

function updateExplore() {
    const demandShift = parseInt(document.getElementById('demand-slider').value);
    const supplyShift = parseInt(document.getElementById('supply-slider').value);
    
    // Draw graph
    const canvas = document.getElementById('explore-canvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 450, 400);
    
    const margin = { left: 50, right: 30, top: 30, bottom: 50 };
    const w = 450 - margin.left - margin.right;
    const h = 400 - margin.top - margin.bottom;
    
    // Axes
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(margin.left, margin.top);
    ctx.lineTo(margin.left, margin.top + h);
    ctx.lineTo(margin.left + w, margin.top + h);
    ctx.stroke();
    
    // Labels
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Quantity (pairs)', margin.left + w/2, 390);
    ctx.save();
    ctx.translate(15, margin.top + h/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Price ($)', 0, 0);
    ctx.restore();
    
    // Draw curves with shifts
    drawDemandCurveExplore(ctx, margin, w, h, demandShift * 40);
    drawSupplyCurveExplore(ctx, margin, w, h, supplyShift * 40);
    
    // Calculate new equilibrium
    const basePrice = 100;
    const baseQty = 50;
    const newPrice = basePrice + (demandShift - supplyShift) * 15;
    const newQty = baseQty + (demandShift + supplyShift) * 8;
    
    // Draw equilibrium
    const eqX = margin.left + (newQty / 100) * w;
    const eqY = margin.top + h - (newPrice / 200) * h;
    
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 1;
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.moveTo(eqX, eqY);
    ctx.lineTo(eqX, margin.top + h);
    ctx.moveTo(eqX, eqY);
    ctx.lineTo(margin.left, eqY);
    ctx.stroke();
    ctx.setLineDash([]);
    
    ctx.fillStyle = '#F59E0B';
    ctx.beginPath();
    ctx.arc(eqX, eqY, 10, 0, Math.PI * 2);
    ctx.fill();
    
    // Update info
    document.getElementById('eq-price').textContent = '$' + newPrice;
    document.getElementById('eq-qty').textContent = newQty + ' pairs';
    
    let status = '';
    if (demandShift > 0 && supplyShift === 0) status = '<strong>Demand increased!</strong> Price ‚¨ÜÔ∏è Quantity ‚¨ÜÔ∏è';
    else if (demandShift < 0 && supplyShift === 0) status = '<strong>Demand decreased!</strong> Price ‚¨áÔ∏è Quantity ‚¨áÔ∏è';
    else if (supplyShift > 0 && demandShift === 0) status = '<strong>Supply increased!</strong> Price ‚¨áÔ∏è Quantity ‚¨ÜÔ∏è';
    else if (supplyShift < 0 && demandShift === 0) status = '<strong>Supply decreased!</strong> Price ‚¨ÜÔ∏è Quantity ‚¨áÔ∏è';
    else if (demandShift === 0 && supplyShift === 0) status = '<strong>Market Status:</strong> Balanced ‚öñÔ∏è';
    else status = '<strong>Both curves shifted!</strong> Complex change.';
    
    document.getElementById('market-status').innerHTML = status;
}

function drawDemandCurveExplore(ctx, margin, w, h, shift) {
    ctx.strokeStyle = '#E8505B';
    ctx.lineWidth = 3;
    ctx.beginPath();
    for (let i = 0; i <= 100; i++) {
        const x = margin.left + (i/100) * w + shift;
        const y = margin.top + (i/100) * h;
        if (x >= margin.left && x <= margin.left + w) {
            if (i === 0 || x === margin.left + shift) ctx.moveTo(Math.max(margin.left, x), y);
            else ctx.lineTo(x, y);
        }
    }
    ctx.stroke();
    ctx.fillStyle = '#E8505B';
    ctx.font = 'bold 16px Arial';
    ctx.fillText('D', Math.min(margin.left + w - 10, margin.left + w - 10 + shift), margin.top + h - 30);
}

function drawSupplyCurveExplore(ctx, margin, w, h, shift) {
    ctx.strokeStyle = '#14B8A6';
    ctx.lineWidth = 3;
    ctx.beginPath();
    for (let i = 0; i <= 100; i++) {
        const x = margin.left + (i/100) * w - shift;
        const y = margin.top + h - (i/100) * h;
        if (x >= margin.left && x <= margin.left + w) {
            if (i === 0 || x === margin.left - shift) ctx.moveTo(Math.max(margin.left, x), y);
            else ctx.lineTo(x, y);
        }
    }
    ctx.stroke();
    ctx.fillStyle = '#14B8A6';
    ctx.font = 'bold 16px Arial';
    ctx.fillText('S', Math.min(margin.left + w - 10, margin.left + w - 10 - shift), margin.top + 40);
}

function resetExplore() {
    document.getElementById('demand-slider').value = 0;
    document.getElementById('supply-slider').value = 0;
    updateExplore();
}

// ==================== CHALLENGE MODE (Market Madness) ====================
const challenges = [
    { scenario: "A celebrity posts wearing your sneakers!", shift: "demand", direction: "increase", priceChange: "increase", qtyChange: "increase" },
    { scenario: "The cost of rubber (a key material) skyrockets.", shift: "supply", direction: "decrease", priceChange: "increase", qtyChange: "decrease" },
    { scenario: "A new competitor releases a cooler sneaker.", shift: "demand", direction: "decrease", priceChange: "decrease", qtyChange: "decrease" },
    { scenario: "A new factory opens, doubling production capacity.", shift: "supply", direction: "increase", priceChange: "decrease", qtyChange: "increase" },
    { scenario: "The economy booms - everyone has more money!", shift: "demand", direction: "increase", priceChange: "increase", qtyChange: "increase" },
    { scenario: "Workers at factories go on strike.", shift: "supply", direction: "decrease", priceChange: "increase", qtyChange: "decrease" },
    { scenario: "Sneakers become \"uncool\" - everyone wants boots now.", shift: "demand", direction: "decrease", priceChange: "decrease", qtyChange: "decrease" },
    { scenario: "New automation makes production cheaper.", shift: "supply", direction: "increase", priceChange: "decrease", qtyChange: "increase" },
    { scenario: "A fitness craze hits - everyone wants athletic shoes!", shift: "demand", direction: "increase", priceChange: "increase", qtyChange: "increase" },
    { scenario: "Tariffs on imported materials increase costs.", shift: "supply", direction: "decrease", priceChange: "increase", qtyChange: "decrease" },
    { scenario: "Back-to-school season arrives.", shift: "demand", direction: "increase", priceChange: "increase", qtyChange: "increase" },
    { scenario: "Several sneaker companies go out of business.", shift: "supply", direction: "decrease", priceChange: "increase", qtyChange: "decrease" }
];

function renderChallengeMode() {
    if (state.challengeRound >= 12) {
        showChallengeResults();
        return;
    }
    
    const challenge = challenges[state.challengeRound];
    const container = document.getElementById('practice-content');
    
    container.innerHTML = `
        <div class="animate-in">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <span style="font-size: 1.2rem; font-weight: bold; color: #2B2D42;">Round ${state.challengeRound + 1} of 12</span>
                <span style="font-size: 1.2rem; font-weight: bold; color: #14B8A6;">Score: ${state.challengeScore}</span>
            </div>
            
            <div class="news-ticker">
                <strong>üì∞ MARKET NEWS:</strong> ${challenge.scenario}
            </div>
            
            <div style="display: flex; gap: 30px;">
                <div style="flex: 1;">
                    <canvas id="challenge-canvas" width="400" height="350"></canvas>
                </div>
                <div style="flex: 1;">
                    <h3 style="color: #2B2D42; margin-bottom: 15px;">What happens?</h3>
                    
                    <p style="margin-bottom: 10px;"><strong>1. Which curve shifts?</strong></p>
                    <div class="btn-row" id="curve-choice">
                        <button class="btn-small" onclick="selectCurve('demand')">Demand</button>
                        <button class="btn-small" onclick="selectCurve('supply')">Supply</button>
                    </div>
                    
                    <p style="margin-bottom: 10px; margin-top: 20px;"><strong>2. Which direction?</strong></p>
                    <div class="btn-row" id="direction-choice">
                        <button class="btn-small" onclick="selectDirection('increase')">Increase (‚Üí)</button>
                        <button class="btn-small" onclick="selectDirection('decrease')">Decrease (‚Üê)</button>
                    </div>
                    
                    <p style="margin-bottom: 10px; margin-top: 20px;"><strong>3. What happens to equilibrium PRICE?</strong></p>
                    <div class="btn-row" id="price-choice">
                        <button class="btn-small" onclick="selectPrice('increase')">‚¨ÜÔ∏è Increases</button>
                        <button class="btn-small" onclick="selectPrice('decrease')">‚¨áÔ∏è Decreases</button>
                    </div>
                    
                    <button class="btn btn-primary" style="margin-top: 25px; width: 100%;" id="submit-challenge" onclick="submitChallenge()" disabled>Submit Answer</button>
                    
                    <div id="challenge-feedback" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>
    `;
    
    state.challengeAnswers = { curve: null, direction: null, price: null };
    drawChallengeGraph();
}

let challengeAnswers = { curve: null, direction: null, price: null };

function selectCurve(choice) {
    challengeAnswers.curve = choice;
    document.querySelectorAll('#curve-choice .btn-small').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    checkChallengeReady();
}

function selectDirection(choice) {
    challengeAnswers.direction = choice;
    document.querySelectorAll('#direction-choice .btn-small').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    checkChallengeReady();
}

function selectPrice(choice) {
    challengeAnswers.price = choice;
    document.querySelectorAll('#price-choice .btn-small').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    checkChallengeReady();
}

function checkChallengeReady() {
    const ready = challengeAnswers.curve && challengeAnswers.direction && challengeAnswers.price;
    document.getElementById('submit-challenge').disabled = !ready;
}

function drawChallengeGraph() {
    const canvas = document.getElementById('challenge-canvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 400, 350);
    
    const margin = { left: 50, right: 30, top: 30, bottom: 50 };
    const w = 400 - margin.left - margin.right;
    const h = 350 - margin.top - margin.bottom;
    
    // Axes
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(margin.left, margin.top);
    ctx.lineTo(margin.left, margin.top + h);
    ctx.lineTo(margin.left + w, margin.top + h);
    ctx.stroke();
    
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Quantity', margin.left + w/2, 340);
    ctx.save();
    ctx.translate(15, margin.top + h/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Price', 0, 0);
    ctx.restore();
    
    drawBothCurves(ctx, margin, w, h, 0, 0);
    drawEquilibriumPoint(ctx, margin, w, h, 0, 0);
}

function submitChallenge() {
    const challenge = challenges[state.challengeRound];
    let points = 0;
    let feedback = [];
    
    if (challengeAnswers.curve === challenge.shift) {
        points += 40;
        feedback.push('‚úÖ Correct curve!');
    } else {
        feedback.push('‚ùå Wrong curve - it was ' + challenge.shift);
    }
    
    if (challengeAnswers.direction === challenge.direction) {
        points += 30;
        feedback.push('‚úÖ Correct direction!');
    } else {
        feedback.push('‚ùå Wrong direction - it ' + challenge.direction + 's');
    }
    
    if (challengeAnswers.price === challenge.priceChange) {
        points += 30;
        feedback.push('‚úÖ Correct price change!');
    } else {
        feedback.push('‚ùå Price actually ' + challenge.priceChange + 's');
    }
    
    state.challengeScore += points;
    
    document.getElementById('challenge-feedback').innerHTML = `
        <div class="feedback ${points === 100 ? 'correct' : points >= 40 ? 'info' : 'incorrect'}">
            <strong>+${points} points!</strong><br>
            ${feedback.join('<br>')}
        </div>
        <button class="btn btn-primary" style="margin-top: 15px;" onclick="nextChallenge()">Next Round ‚Üí</button>
    `;
    
    document.getElementById('submit-challenge').disabled = true;
    document.querySelectorAll('.btn-small').forEach(b => b.disabled = true);
}

function nextChallenge() {
    state.challengeRound++;
    if (state.challengeRound >= 12) {
        showChallengeResults();
    } else {
        renderChallengeMode();
    }
}

function showChallengeResults() {
    const container = document.getElementById('practice-content');
    const percent = Math.round((state.challengeScore / 1200) * 100);
    
    container.innerHTML = `
        <div class="score-screen animate-in">
            <h2 style="color: #2B2D42;">üèÜ Market Madness Complete!</h2>
            <div class="score-big">${state.challengeScore}</div>
            <div class="score-label">out of 1,200 points (${percent}%)</div>
            
            <div class="score-details">
                <p>${percent >= 80 ? 'üåü Excellent!' : percent >= 60 ? 'üëç Good job!' : 'üìö Keep practicing!'}</p>
            </div>
            
            <button class="btn btn-primary" onclick="completePractice()">Continue to Market Mogul ‚Üí</button>
            <button class="btn btn-secondary" style="margin-left: 10px;" onclick="retryChallenges()">Try Again</button>
        </div>
    `;
}

function retryChallenges() {
    state.challengeRound = 0;
    state.challengeScore = 0;
    renderChallengeMode();
}

function completePractice() {
    state.practiceComplete = true;
    unlockSection('simulate');
    showSection('simulate');
}

// ==================== SIMULATION MODE (Market Mogul) ====================
const simEvents = [
    { week: 2, news: "A famous rapper is spotted wearing your sneakers!", effect: "demand", change: 20 },
    { week: 3, news: "Rubber prices spike due to supply chain issues.", effect: "cost", change: 15 },
    { week: 4, news: "A competitor releases a hot new shoe.", effect: "demand", change: -15 },
    { week: 5, news: "Your sneakers go viral on TikTok!", effect: "demand", change: 25 },
    { week: 6, news: "Factory workers demand higher wages.", effect: "cost", change: 10 },
    { week: 7, news: "Back-to-school shopping season begins!", effect: "demand", change: 20 },
    { week: 8, news: "A recession hits - consumers cut spending.", effect: "demand", change: -25 }
];

function initSimulate() {
    state.simWeek = 1;
    state.simCash = 1000;
    state.simInventory = 50;
    state.simReputation = 50;
    state.simPrice = 100;
    state.simDemandMod = 0;
    state.simCostMod = 0;
    state.simHistory = [];
    
    renderSimWeek();
}

function renderSimWeek() {
    if (state.simWeek > 8) {
        showSimResults();
        return;
    }
    
    // Check for event
    const event = simEvents.find(e => e.week === state.simWeek);
    
    // Calculate demand at current price
    const baseDemand = 100 - state.simPrice * 0.6; // Higher price = lower demand
    const adjustedDemand = Math.max(5, Math.min(100, baseDemand + state.simDemandMod));
    
    const container = document.getElementById('simulate-container');
    container.innerHTML = `
        <div class="animate-in">
            <div class="sim-header">
                <div class="sim-stat">
                    <div class="sim-stat-value">Week ${state.simWeek}</div>
                    <div class="sim-stat-label">of 8</div>
                </div>
                <div class="sim-stat">
                    <div class="sim-stat-value">$${state.simCash.toLocaleString()}</div>
                    <div class="sim-stat-label">Cash</div>
                </div>
                <div class="sim-stat">
                    <div class="sim-stat-value">${state.simInventory}</div>
                    <div class="sim-stat-label">Inventory</div>
                </div>
                <div class="sim-stat">
                    <div class="sim-stat-value">${state.simReputation}%</div>
                    <div class="sim-stat-label">Reputation</div>
                </div>
            </div>
            
            ${event ? `<div class="news-ticker"><strong>üì∞ BREAKING NEWS:</strong> ${event.news}</div>` : ''}
            
            <div style="display: flex; gap: 30px;">
                <div style="flex: 1;">
                    <canvas id="sim-canvas" width="400" height="300"></canvas>
                    <div style="text-align: center; margin-top: 10px; color: #666;">
                        Current market demand: ~${Math.round(adjustedDemand)} pairs/week
                    </div>
                </div>
                <div style="flex: 1;">
                    <h3 style="color: #2B2D42; margin-bottom: 15px;">Set Your Price</h3>
                    
                    <div style="text-align: center; font-size: 2.5rem; font-weight: bold; color: #14B8A6; margin: 20px 0;">
                        $<span id="price-display">${state.simPrice}</span>
                    </div>
                    
                    <input type="range" id="price-slider" min="50" max="200" value="${state.simPrice}" 
                           style="width: 100%;" oninput="updatePriceDisplay()">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #888;">
                        <span>$50 (Budget)</span><span>$200 (Premium)</span>
                    </div>
                    
                    <div style="background: #F8F8F8; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p><strong>Production Cost:</strong> $${50 + state.simCostMod}/pair</p>
                        <p><strong>Your Profit Margin:</strong> <span id="margin-display">$${state.simPrice - 50 - state.simCostMod}/pair</span></p>
                        <p><strong>Estimated Sales:</strong> <span id="sales-estimate">${Math.round(adjustedDemand)}</span> pairs</p>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="simSellWeek()">
                        Sell This Week ‚Üí
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // Apply event effects
    if (event) {
        if (event.effect === 'demand') state.simDemandMod += event.change;
        else if (event.effect === 'cost') state.simCostMod += event.change;
    }
    
    drawSimGraph();
}

function updatePriceDisplay() {
    const price = parseInt(document.getElementById('price-slider').value);
    state.simPrice = price;
    document.getElementById('price-display').textContent = price;
    document.getElementById('margin-display').textContent = '$' + (price - 50 - state.simCostMod) + '/pair';
    
    const baseDemand = 100 - price * 0.6 + state.simDemandMod;
    const adjustedDemand = Math.max(5, Math.min(100, baseDemand));
    document.getElementById('sales-estimate').textContent = Math.round(adjustedDemand);
    
    drawSimGraph();
}

function drawSimGraph() {
    const canvas = document.getElementById('sim-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 400, 300);
    
    const margin = { left: 50, right: 30, top: 20, bottom: 40 };
    const w = 400 - margin.left - margin.right;
    const h = 300 - margin.top - margin.bottom;
    
    // Axes
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(margin.left, margin.top);
    ctx.lineTo(margin.left, margin.top + h);
    ctx.lineTo(margin.left + w, margin.top + h);
    ctx.stroke();
    
    // Demand curve (shifted by simDemandMod)
    ctx.strokeStyle = '#E8505B';
    ctx.lineWidth = 3;
    ctx.beginPath();
    const demandShiftPx = state.simDemandMod * 1.5;
    for (let i = 0; i <= 100; i++) {
        const x = margin.left + (i/100) * w + demandShiftPx;
        const y = margin.top + (i/100) * h;
        if (x >= margin.left && x <= margin.left + w) {
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
    }
    ctx.stroke();
    
    // Supply curve (shifted by cost changes)
    ctx.strokeStyle = '#14B8A6';
    ctx.lineWidth = 3;
    ctx.beginPath();
    const supplyShiftPx = -state.simCostMod * 1.5;
    for (let i = 0; i <= 100; i++) {
        const x = margin.left + (i/100) * w + supplyShiftPx;
        const y = margin.top + h - (i/100) * h;
        if (x >= margin.left && x <= margin.left + w) {
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
    }
    ctx.stroke();
    
    // Current price line
    const priceY = margin.top + h - ((state.simPrice - 50) / 150) * h;
    ctx.strokeStyle = '#F59E0B';
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.moveTo(margin.left, priceY);
    ctx.lineTo(margin.left + w, priceY);
    ctx.stroke();
    ctx.setLineDash([]);
    
    ctx.fillStyle = '#F59E0B';
    ctx.font = 'bold 12px Arial';
    ctx.fillText('Your Price: $' + state.simPrice, margin.left + w - 80, priceY - 5);
}

function simSellWeek() {
    const price = state.simPrice;
    const cost = 50 + state.simCostMod;
    const margin = price - cost;
    
    // Calculate sales based on price and demand
    const baseDemand = 100 - price * 0.6 + state.simDemandMod;
    let sales = Math.max(0, Math.min(state.simInventory, Math.round(baseDemand + (Math.random() - 0.5) * 10)));
    
    // Calculate results
    const revenue = sales * price;
    const profit = sales * margin;
    const newCash = state.simCash + profit;
    const newInventory = state.simInventory - sales + 30; // Restock 30 per week
    
    // Reputation changes based on pricing
    let repChange = 0;
    if (price > 150) repChange = -5; // Premium pricing hurts rep
    else if (price < 80) repChange = 3; // Budget pricing helps rep
    if (sales === 0) repChange = -10; // No sales = bad
    
    // Save history
    state.simHistory.push({
        week: state.simWeek,
        price: price,
        sales: sales,
        profit: profit
    });
    
    // Show results
    const container = document.getElementById('simulate-container');
    container.innerHTML = `
        <div class="results-panel animate-in" style="text-align: center; padding: 40px;">
            <h2 style="color: #2B2D42; margin-bottom: 20px;">Week ${state.simWeek} Results</h2>
            
            <div style="display: flex; justify-content: center; gap: 40px; margin: 30px 0;">
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: #14B8A6;">${sales}</div>
                    <div style="color: #666;">Pairs Sold</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: #14B8A6;">$${revenue.toLocaleString()}</div>
                    <div style="color: #666;">Revenue</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: ${profit >= 0 ? '#14B8A6' : '#EF4444'};">${profit >= 0 ? '+' : ''}$${profit.toLocaleString()}</div>
                    <div style="color: #666;">Profit</div>
                </div>
            </div>
            
            <div class="feedback ${profit > 0 ? 'correct' : 'incorrect'}">
                ${profit > 500 ? 'üî• Great week!' : profit > 0 ? 'üëç Profitable week!' : 'üìâ Lost money this week.'}
                ${repChange > 0 ? ' Reputation ‚¨ÜÔ∏è' : repChange < 0 ? ' Reputation ‚¨áÔ∏è' : ''}
            </div>
            
            <button class="btn btn-primary" style="margin-top: 30px;" onclick="advanceSimWeek()">
                ${state.simWeek < 8 ? 'Next Week ‚Üí' : 'See Final Results ‚Üí'}
            </button>
        </div>
    `;
    
    // Update state
    state.simCash = newCash;
    state.simInventory = Math.min(100, newInventory);
    state.simReputation = Math.max(0, Math.min(100, state.simReputation + repChange));
}

function advanceSimWeek() {
    state.simWeek++;
    renderSimWeek();
}

function showSimResults() {
    const totalProfit = state.simHistory.reduce((sum, w) => sum + w.profit, 0);
    const totalSales = state.simHistory.reduce((sum, w) => sum + w.sales, 0);
    const avgPrice = Math.round(state.simHistory.reduce((sum, w) => sum + w.price, 0) / 8);
    
    const container = document.getElementById('simulate-container');
    container.innerHTML = `
        <div class="score-screen animate-in">
            <h2 style="color: #2B2D42;">üè™ Market Mogul Complete!</h2>
            
            <div style="display: flex; justify-content: center; gap: 40px; margin: 30px 0;">
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: #14B8A6;">$${state.simCash.toLocaleString()}</div>
                    <div style="color: #666;">Final Cash</div>
                </div>
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: #F59E0B;">${state.simReputation}%</div>
                    <div style="color: #666;">Reputation</div>
                </div>
            </div>
            
            <div class="score-details">
                <p><strong>Total Pairs Sold:</strong> ${totalSales}</p>
                <p><strong>Total Profit:</strong> $${totalProfit.toLocaleString()}</p>
                <p><strong>Average Price:</strong> $${avgPrice}</p>
            </div>
            
            <div class="feedback ${totalProfit > 2000 ? 'correct' : totalProfit > 0 ? 'info' : 'incorrect'}">
                ${totalProfit > 3000 ? 'üåü Market Master!' : totalProfit > 2000 ? 'üëç Solid performance!' : totalProfit > 0 ? 'üìà Room to improve!' : 'üìâ Tough market!'}
            </div>
            
            <button class="btn btn-primary" style="margin-top: 30px;" onclick="completeSimulate()">Continue to Quiz ‚Üí</button>
        </div>
    `;
}

function completeSimulate() {
    state.simulateComplete = true;
    unlockSection('quiz');
    showSection('quiz');
}

// ==================== QUIZ ====================
const quizQuestions = [
    {
        q: "What does the Law of Demand state?",
        options: [
            "As price increases, quantity demanded increases",
            "As price increases, quantity demanded decreases",
            "As price increases, supply increases",
            "Price and demand are unrelated"
        ],
        correct: 1
    },
    {
        q: "What does the Law of Supply state?",
        options: [
            "As price increases, quantity supplied decreases",
            "As price increases, quantity supplied increases",
            "Supply is always constant",
            "Supply and price are unrelated"
        ],
        correct: 1
    },
    {
        q: "What is equilibrium?",
        options: [
            "When price is at its highest point",
            "When there is a shortage in the market",
            "When quantity demanded equals quantity supplied",
            "When supply is greater than demand"
        ],
        correct: 2
    },
    {
        q: "A shortage occurs when:",
        options: [
            "Price is above equilibrium",
            "Price is below equilibrium",
            "Supply increases",
            "Demand decreases"
        ],
        correct: 1
    },
    {
        q: "A surplus occurs when:",
        options: [
            "Price is below equilibrium",
            "Demand exceeds supply",
            "Price is above equilibrium",
            "The market clears"
        ],
        correct: 2
    },
    {
        q: "If a celebrity endorses a product, what happens to the demand curve?",
        options: [
            "Shifts left (decreases)",
            "Shifts right (increases)",
            "Stays the same",
            "Becomes vertical"
        ],
        correct: 1
    },
    {
        q: "If production costs increase, what happens to the supply curve?",
        options: [
            "Shifts right (increases)",
            "Shifts left (decreases)",
            "Stays the same",
            "Becomes horizontal"
        ],
        correct: 1
    },
    {
        q: "If demand increases while supply stays constant, equilibrium price will:",
        options: [
            "Decrease",
            "Stay the same",
            "Increase",
            "Become zero"
        ],
        correct: 2
    },
    {
        q: "If supply increases while demand stays constant, equilibrium price will:",
        options: [
            "Increase",
            "Decrease",
            "Stay the same",
            "Double"
        ],
        correct: 1
    },
    {
        q: "Which would cause the demand for sneakers to DECREASE?",
        options: [
            "Sneakers become trendy",
            "Consumer income increases",
            "A popular alternative (boots) becomes cheaper",
            "The population grows"
        ],
        correct: 2
    },
    {
        q: "The demand curve slopes:",
        options: [
            "Upward (positive slope)",
            "Downward (negative slope)",
            "Horizontal",
            "Vertical"
        ],
        correct: 1
    },
    {
        q: "The supply curve slopes:",
        options: [
            "Downward (negative slope)",
            "Upward (positive slope)",
            "Horizontal",
            "Vertical"
        ],
        correct: 1
    }
];

let currentQuizQuestion = 0;
let quizAnswers = [];

function initQuiz() {
    currentQuizQuestion = 0;
    quizAnswers = [];
    state.quizLocked = false;
    renderQuizQuestion();
}

function renderQuizQuestion() {
    if (currentQuizQuestion >= quizQuestions.length) {
        showQuizResults();
        return;
    }
    
    const q = quizQuestions[currentQuizQuestion];
    const container = document.getElementById('quiz-container');
    
    container.innerHTML = `
        <div class="animate-in">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <span style="font-size: 1.2rem; font-weight: bold; color: #2B2D42;">Question ${currentQuizQuestion + 1} of ${quizQuestions.length}</span>
                <span style="color: #888;">Score: ${quizAnswers.filter(a => a.correct).length}/${quizAnswers.length}</span>
            </div>
            
            <div class="quiz-question">
                <h3>${q.q}</h3>
                <div class="quiz-options">
                    ${q.options.map((opt, i) => `
                        <div class="quiz-option" onclick="selectQuizAnswer(${i})" id="quiz-opt-${i}">${opt}</div>
                    `).join('')}
                </div>
            </div>
            
            <button class="btn btn-primary" id="quiz-submit" onclick="submitQuizAnswer()" disabled style="width: 100%;">Submit Answer</button>
            <div id="quiz-feedback" style="margin-top: 15px;"></div>
        </div>
    `;
}

let selectedQuizAnswer = null;

function selectQuizAnswer(idx) {
    selectedQuizAnswer = idx;
    document.querySelectorAll('.quiz-option').forEach((el, i) => {
        el.classList.toggle('selected', i === idx);
    });
    document.getElementById('quiz-submit').disabled = false;
}

function submitQuizAnswer() {
    const q = quizQuestions[currentQuizQuestion];
    const isCorrect = selectedQuizAnswer === q.correct;
    
    quizAnswers.push({ question: currentQuizQuestion, selected: selectedQuizAnswer, correct: isCorrect });
    
    // Show correct/incorrect
    document.querySelectorAll('.quiz-option').forEach((el, i) => {
        el.classList.remove('selected');
        if (i === q.correct) el.classList.add('correct');
        else if (i === selectedQuizAnswer && !isCorrect) el.classList.add('incorrect');
        el.onclick = null;
    });
    
    document.getElementById('quiz-feedback').innerHTML = `
        <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
            ${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect. The answer was: ' + q.options[q.correct]}
        </div>
    `;
    
    document.getElementById('quiz-submit').textContent = currentQuizQuestion < quizQuestions.length - 1 ? 'Next Question ‚Üí' : 'See Results ‚Üí';
    document.getElementById('quiz-submit').onclick = nextQuizQuestion;
}

function nextQuizQuestion() {
    currentQuizQuestion++;
    selectedQuizAnswer = null;
    renderQuizQuestion();
}

function showQuizResults() {
    const correct = quizAnswers.filter(a => a.correct).length;
    const percent = Math.round((correct / quizQuestions.length) * 100);
    state.quizScore = correct;
    state.quizComplete = true;
    state.quizLocked = true;
    updateProgress();
    
    const container = document.getElementById('quiz-container');
    container.innerHTML = `
        <div class="score-screen animate-in">
            <h2 style="color: #2B2D42;">üìù Quiz Complete!</h2>
            <div class="score-big">${correct}/${quizQuestions.length}</div>
            <div class="score-label">${percent}%</div>
            
            <div class="score-details">
                <p>${percent >= 90 ? 'üåü Outstanding!' : percent >= 80 ? 'üéâ Great job!' : percent >= 70 ? 'üëç Good work!' : 'üìö Review the material!'}</p>
            </div>
            
            <div class="print-section">
                <h3 style="margin-bottom: 15px;">üñ®Ô∏è Print Your Score</h3>
                <input type="text" id="student-name" placeholder="Your Name">
                <input type="text" id="student-period" placeholder="Period">
                <br><br>
                <button class="btn btn-secondary" onclick="printScore()">Print Score Sheet</button>
            </div>
            
            <div style="margin-top: 30px; padding: 20px; background: #FEE2E2; border-radius: 8px; color: #991B1B;">
                <strong>üîí Quiz Locked</strong><br>
                Your score has been recorded. You cannot retake this quiz.
            </div>
        </div>
    `;
}

function printScore() {
    const name = document.getElementById('student-name').value || '________________';
    const period = document.getElementById('student-period').value || '____';
    const correct = state.quizScore;
    const percent = Math.round((correct / quizQuestions.length) * 100);
    const date = new Date().toLocaleDateString();
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head><title>Quiz Score</title></head>
        <body style="font-family: Arial, sans-serif; padding: 40px; text-align: center;">
            <h1 style="color: #14B8A6;">ClassClick</h1>
            <h2>Supply & Demand Quiz Results</h2>
            <hr>
            <p><strong>Name:</strong> ${name}</p>
            <p><strong>Period:</strong> ${period}</p>
            <p><strong>Date:</strong> ${date}</p>
            <hr>
            <div style="font-size: 3rem; font-weight: bold; margin: 30px 0; color: #14B8A6;">${correct}/${quizQuestions.length}</div>
            <div style="font-size: 1.5rem; color: #666;">${percent}%</div>
            <hr>
            <p style="font-size: 0.8rem; color: #999;">ClassClick by Robert Jones | SKELKEYTEC</p>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

// ==================== INITIALIZE ====================
document.addEventListener('DOMContentLoaded', function() {
    renderLesson();
});
</script>
</body>
</html>
